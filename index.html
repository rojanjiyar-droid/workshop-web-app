<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ… v5.0 - ØªØ¶Ù…ÛŒÙ†ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯</title>
<style>
* {margin:0;padding:0;box-sizing:border-box}
body {
  font-family:Tahoma,Arial,sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;
  color:#2c3e50;
  line-height:1.6;
  padding:10px;
  direction:rtl;
  text-align:center
}
.login {
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:20px
}
.login-card {
  background:#f8f9fa;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
  padding:40px;
  width:100%;
  max-width:400px;
  position:relative
}
.login-card::before {
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:5px;
  background:linear-gradient(90deg,#27ae60,#3498db)
}
.logo {
  width:90px;
  height:90px;
  margin:0 auto 25px;
  background:linear-gradient(135deg,#27ae60,#2ecc71);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:32px;
  font-weight:bold;
  box-shadow:0 8px 25px rgba(39,174,96,0.4)
}
h1 {
  color:#2c3e50 !important;
  font-size:28px !important;
  margin-bottom:30px !important
}
.form-control {
  width:100%;
  padding:18px;
  border:2px solid #e0e0e0;
  border-radius:15px;
  font-size:18px;
  margin-bottom:20px;
  transition:all 0.3s;
  font-family:inherit;
  text-align:center;
  background:#fff;
  color:#2c3e50
}
.form-control:focus {
  border-color:#27ae60;
  outline:none;
  box-shadow:0 0 0 4px rgba(39,174,96,0.2);
  transform:scale(1.02)
}
.btn {
  padding:20px 40px;
  border:none;
  border-radius:15px;
  font-size:20px;
  font-weight:bold;
  cursor:pointer;
  transition:all 0.3s;
  background:linear-gradient(135deg,#27ae60,#2ecc71);
  color:white;
  width:100%;
  margin-top:25px;
  box-shadow:0 8px 25px rgba(39,174,96,0.4)
}
.btn:hover {
  transform:translateY(-3px);
  box-shadow:0 12px 35px rgba(39,174,96,0.5)
}
.btn:active {
  transform:translateY(-1px)
}
.main-container {
  background:#f8f9fa;
  border-radius:25px;
  box-shadow:0 15px 40px rgba(0,0,0,0.3);
  overflow:hidden;
  min-height:calc(100vh - 40px);
  margin:20px auto;
  max-width:1400px;
  display:none;
  animation:slideUp 0.5s ease-out
}
@keyframes slideUp {
  from {transform:translateY(50px);opacity:0}
  to {transform:translateY(0);opacity:1}
}
.main-header {
  background:linear-gradient(135deg,#2c3e50,#34495e);
  color:white;
  padding:25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:15px
}
.nav-btn {
  background:none;
  border:none;
  color:white;
  padding:18px 25px;
  cursor:pointer;
  font-size:16px;
  display:flex;
  align-items:center;
  gap:10px;
  flex:1;
  border-radius:0;
  transition:all 0.3s;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis
}
.nav-btn:hover,.nav-btn.active {
  background:#3498db;
  transform:translateY(-2px)
}
.content-area {
  padding:30px;
  min-height:500px
}
.card {
  background:white;
  border-radius:20px;
  padding:30px;
  margin-bottom:30px;
  border-right:6px solid #3498db;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  transition:all 0.3s
}
.card:hover {
  transform:translateY(-5px);
  box-shadow:0 20px 50px rgba(0,0,0,0.15)
}
.stats-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
  margin-bottom:30px
}
.stat-card {
  background:linear-gradient(135deg,#3498db,#2980b9);
  color:white;
  padding:30px;
  border-radius:20px;
  text-align:center;
  position:relative;
  overflow:hidden
}
.stat-card::before {
  content:'';
  position:absolute;
  top:-50%;
  right:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
  animation:rotate 20s linear infinite
}
@keyframes rotate {
  0% {transform:rotate(0deg)}
  100% {transform:rotate(360deg)}
}
.stat-value {
  font-size:36px;
  font-weight:bold;
  margin-bottom:10px;
  position:relative;
  z-index:2
}
.table {
  width:100%;
  border-collapse:collapse;
  margin-top:25px;
  background:white;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 5px 20px rgba(0,0,0,0.1)
}
.table th {
  background:linear-gradient(135deg,#2c3e50,#34495e);
  color:white;
  padding:18px;
  text-align:right;
  font-weight:bold
}
.table td {
  padding:18px;
  text-align:right;
  border-bottom:1px solid #eee;
  transition:all 0.3s
}
.table tr:hover td {
  background:#f8f9ff;
  transform:scale(1.01)
}
.form-row {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
  margin-bottom:25px
}
.btn-small {
  padding:12px 20px !important;
  font-size:14px !important;
  width:auto !important;
  margin:5px
}
.btn-danger {
  background:linear-gradient(135deg,#e74c3c,#c0392b) !important
}
.page {
  display:none;
  animation:fadeIn 0.4s ease-in
}
.page.active {
  display:block
}
@keyframes fadeIn {
  from {opacity:0;transform:translateY(20px)}
  to {opacity:1;transform:translateY(0)}
}
@media (max-width:768px) {
  .main-header {flex-direction:column;text-align:center;gap:20px}
  .nav-btn {padding:15px 10px;font-size:14px;flex:none;width:auto}
  .form-row {grid-template-columns:1fr}
  .stats-grid {grid-template-columns:1fr}
}
.success-msg {
  background:linear-gradient(135deg,#d4edda,#c3e6cb);
  color:#155724;
  padding:20px;
  border-radius:15px;
  margin:20px 0;
  border-right:6px solid #28a745;
  font-weight:bold;
  animation:pulse 2s infinite
}
@keyframes pulse {
  0%,100% {box-shadow:0 0 0 0 rgba(40,167,69,0.7)}
  50% {box-shadow:0 0 0 15px rgba(40,167,69,0)}
}
</style>
</head>
<body>

<!-- ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† -->
<div id="loginPage" style="display:block">
  <div class="login-card">
    <div class="logo">CF</div>
    <h1>ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ… v5.0</h1>
    <p style="color:#666;margin-bottom:30px;font-size:16px">Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ - ØªØ¶Ù…ÛŒÙ†ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯!</p>
    
    <input type="text" id="username" class="form-control" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" value="admin" autocomplete="off">
    <input type="password" id="password" class="form-control" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" value="1234" autocomplete="off">
    
    <button class="btn" onclick="doLogin()">
      <span style="margin-left:10px">ğŸš€ ÙˆØ±ÙˆØ¯ ÙÙˆØ±ÛŒ</span>
    </button>
    
    <div style="margin-top:30px;padding:20px;background:rgba(255,255,255,0.8);border-radius:15px;font-size:16px;font-weight:bold;color:#27ae60">
      <div>ğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: <span style="color:#e74c3c">admin</span></div>
      <div>ğŸ”’ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±: <span style="color:#e74c3c">1234</span></div>
      <div style="margin-top:10px;color:#666;font-size:14px">Enter Ø¨Ø²Ù† ÛŒØ§ Ø¯Ú©Ù…Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù† âœ…</div>
    </div>
    
    <div style="margin-top:20px;font-size:12px;color:#999">
      Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙÙˆÙ† â€¢ v5.0 â€¢ 1404
    </div>
  </div>
</div>

<!-- Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ -->
<div id="mainApp" style="display:none">
  <header class="main-header">
    <div>
      <h2 style="margin:0;font-size:28px">ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ…</h2>
      <div id="currentDate" style="font-size:14px;margin-top:5px">1404/09/23</div>
    </div>
    <div style="display:flex;align-items:center;gap:15px">
      <span id="welcomeUser" style="font-weight:bold;font-size:18px"></span>
      <button class="btn btn-small btn-danger" onclick="logoutApp()" style="padding:12px 24px !important">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <!-- Ù…Ù†Ùˆ -->
  <nav style="background:#34495e;display:flex;overflow-x:auto;padding:5px 0">
    <button class="nav-btn active" onclick="showPage('dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
    <button class="nav-btn" onclick="showPage('contracts')">ğŸ“‹ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</button>
    <button class="nav-btn" onclick="showPage('checks')">ğŸ’³ Ú†Ú©â€ŒÙ‡Ø§</button>
    <button class="nav-btn" onclick="showPage('finances')">ğŸ’° Ù…Ø§Ù„ÛŒ</button>
    <button class="nav-btn" onclick="showPage('backup')">â˜ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
  </nav>

  <!-- Ù…Ø­ØªÙˆØ§ -->
  <main class="content-area">
    
    <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div id="dashboard" class="page active">
      <div class="card">
        <h3 style="margin-bottom:25px;color:#2c3e50;font-size:24px">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§ØµÙ„ÛŒ</h3>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalContracts">0</div>
            <div style="font-size:16px">Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ ÙØ¹Ø§Ù„</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalChecks" style="color:#f39c12">0</div>
            <div style="font-size:16px">Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø±ÛŒ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalBalance" style="color:#27ae60">0<span style="font-size:18px">ØªÙˆÙ…Ø§Ù†</span></div>
            <div style="font-size:16px">ØªØ±Ø§Ø² Ù…Ø§Ù„ÛŒ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalTransactions" style="color:#9b59b6">0</div>
            <div style="font-size:16px">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
          </div>
        </div>

        <div style="display:flex;gap:15px;flex-wrap:wrap;justify-content:center;margin-top:30px">
          <button class="btn btn-small" onclick="quickBackup()" style="background:linear-gradient(135deg,#27ae60,#2ecc71)">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</button>
          <button class="btn btn-small" onclick="exportExcel()" style="background:linear-gradient(135deg,#3498db,#2980b9)">ğŸ“Š Ø§Ú©Ø³Ù„</button>
          <button class="btn btn-small btn-danger" onclick="clearAllData()" style="background:linear-gradient(135deg,#e74c3c,#c0392b)">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
        </div>
      </div>

      <div class="success-msg">
        âœ… Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢Ù…Ø§Ø¯Ù‡ â€¢ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ â€¢ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù…Ù†
      </div>
    </div>

    <!-- Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ -->
    <div id="contracts" class="page">
      <div class="card">
        <h3 style="margin-bottom:25px;color:#2c3e50;font-size:24px">ğŸ“‹ Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</h3>
        
        <div class="form-row">
          <input type="text" id="contractCustomer" class="form-control" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ">
          <input type="number" id="contractAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (ØªÙˆÙ…Ø§Ù†)">
          <input type="date" id="contractDate" class="form-control">
          <button class="btn" onclick="addContract()" style="padding:20px 30px !important">â• Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
        </div>

        <div style="overflow-x:auto;margin-top:25px">
          <table class="table" id="contractsTable">
            <thead>
              <tr>
                <th>Ù…Ø´ØªØ±ÛŒ</th>
                <th>Ù…Ø¨Ù„Øº</th>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ú†Ú©â€ŒÙ‡Ø§ -->
    <div id="checks" class="page">
      <div class="card">
        <h3 style="margin-bottom:25px;color:#2c3e50;font-size:24px">ğŸ’³ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ú©â€ŒÙ‡Ø§</h3>
        
        <div class="form-row">
          <input type="text" id="checkNumber" class="form-control" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©">
          <input type="number" id="checkAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
          <input type="text" id="checkBank" class="form-control" placeholder="Ù†Ø§Ù… Ø¨Ø§Ù†Ú©">
          <input type="date" id="checkDueDate" class="form-control">
          <select id="checkStatus" class="form-control" style="padding:18px">
            <option value="Ø¬Ø§Ø±ÛŒ">Ø¬Ø§Ø±ÛŒ</option>
            <option value="ÙˆØµÙˆÙ„">ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡</option>
            <option value="Ø¨Ø±Ú¯Ø´ØªÛŒ">Ø¨Ø±Ú¯Ø´ØªÛŒ</option>
          </select>
          <button class="btn" onclick="addCheck()" style="padding:20px 30px !important">â• Ø«Ø¨Øª Ú†Ú©</button>
        </div>

        <div style="overflow-x:auto;margin-top:25px">
          <table class="table" id="checksTable">
            <thead>
              <tr>
                <th>Ø´Ù…Ø§Ø±Ù‡</th>
                <th>Ù…Ø¨Ù„Øº</th>
                <th>Ø¨Ø§Ù†Ú©</th>
                <th>Ø³Ø±Ø±Ø³ÛŒØ¯</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ù…Ø§Ù„ÛŒ -->
    <div id="finances" class="page">
      <div class="card">
        <h3 style="margin-bottom:25px;color:#2c3e50;font-size:24px">ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡</h3>
        
        <div class="form-row">
          <input type="text" id="financeDesc" class="form-control" placeholder="Ø´Ø±Ø­ Ø¹Ù…Ù„ÛŒØ§Øª">
          <input type="number" id="financeAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
          <select id="financeType" class="form-control" style="padding:18px">
            <option value="income">ğŸ’š Ø¯Ø±Ø¢Ù…Ø¯</option>
            <option value="expense">ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡</option>
          </select>
          <button class="btn" onclick="addFinance()" style="padding:20px 30px !important">â• Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</button>
        </div>

        <div style="overflow-x:auto;margin-top:25px">
          <table class="table" id="financesTable">
            <thead>
              <tr>
                <th>Ø´Ø±Ø­</th>
                <th>Ù…Ø¨Ù„Øº</th>
                <th>Ù†ÙˆØ¹</th>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ù¾Ø´ØªÛŒØ¨Ø§Ù† -->
    <div id="backup" class="page">
      <div class="card">
        <h3 style="margin-bottom:25px;color:#2c3e50;font-size:24px">â˜ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px;margin-bottom:30px">
          <div style="text-align:center;padding:30px;background:#f8f9ff;border-radius:20px">
            <button class="btn" onclick="downloadBackup()" style="width:100%;padding:25px 30px !important;margin-bottom:15px">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† JSON</button>
            <div style="font-size:14px;color:#666">ÙØ§ÛŒÙ„ JSON Ú©Ø§Ù…Ù„ Ø¨Ø§ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
          </div>
          <div style="text-align:center;padding:30px;background:#f8f9ff;border-radius:20px">
            <label style="cursor:pointer;display:block">
              <input type="file" id="backupFile" accept=".json" style="display:none" onchange="restoreBackup(event)">
              <div class="btn" style="width:100%;padding:25px 30px !important;margin-bottom:15px;background:linear-gradient(135deg,#f39c12,#e67e22)">ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² ÙØ§ÛŒÙ„</div>
            </label>
            <div style="font-size:14px;color:#666">ÙØ§ÛŒÙ„ JSON Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
          </div>
          <div style="text-align:center;padding:30px;background:#f8f9ff;border-radius:20px">
            <button class="btn btn-danger" onclick="clearAllData()" style="width:100%;padding:25px 30px !important">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            <div style="font-size:14px;color:#999;margin-top:10px">Ù‡Ø´Ø¯Ø§Ø±: ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª</div>
          </div>
        </div>

        <div style="background:#e8f5e8;padding:25px;border-radius:20px;border-right:6px solid #27ae60">
          <h3 style="color:#2c3e50;margin-bottom:15px">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</h3>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;font-size:16px">
            <div><strong>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§:</strong> <span id="sysContracts">0</span></div>
            <div><strong>Ú†Ú©â€ŒÙ‡Ø§:</strong> <span id="sysChecks">0</span></div>
            <div><strong>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§:</strong> <span id="sysFinances">0</span></div>
            <div><strong>Ø­Ø¬Ù… Ø¯Ø§Ø¯Ù‡:</strong> <span id="sysSize">0KB</span></div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// ==================== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ====================
let appData = JSON.parse(localStorage.getItem('kaleshi_v5')) || {
  contracts: [],
  checks: [],
  finances: [],
  version: '5.0',
  created: new Date().toISOString()
};

// ==================== ÙˆØ±ÙˆØ¯ ØªØ¶Ù…ÛŒÙ†ÛŒ ====================
function doLogin() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  
  console.log('Login attempt:', username, password); // Debug
  
  if (username === 'admin' && password === '1234') {
    console.log('âœ… Login successful');
    
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    document.getElementById('welcomeUser').textContent = 'ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ admin';
    
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    loadAllData();
    updateDateTime();
    updateSystemInfo();
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±
    saveData();
    
    // Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
    setTimeout(() => {
      showNotification('ğŸš€ Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!', 'success');
    }, 500);
    
  } else {
    console.log('âŒ Login failed');
    alert('âŒ Ø®Ø·Ø§!\n\nğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: admin\nğŸ”’ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±: 1234\n\nØ¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯');
    document.getElementById('password').value = '';
    document.getElementById('password').focus();
  }
}

// Enter key support
document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && document.getElementById('loginPage').style.display !== 'none') {
    doLogin();
  }
});

// ==================== Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ====================
function saveData() {
  try {
    localStorage.setItem('kaleshi_v5', JSON.stringify(appData));
    console.log('ğŸ’¾ Data saved');
  } catch(e) {
    console.error('Save error:', e);
  }
}

function loadAllData() {
  loadDashboard();
  loadContractsTable();
  loadChecksTable();
  loadFinancesTable();
}

// ==================== Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ====================
function loadDashboard() {
  document.getElementById('totalContracts').textContent = appData.contracts.length;
  document.getElementById('totalChecks').textContent = appData.checks.length;
  
  const balance = appData.finances.reduce((sum, f) => {
    return f.type === 'income' ? sum + f.amount : sum - f.amount;
  }, 0);
  
  document.getElementById('totalBalance').textContent = balance.toLocaleString();
  document.getElementById('totalTransactions').textContent = appData.finances.length;
}

// ==================== Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ ====================
function loadContractsTable() {
  const tbody = document.querySelector('#contractsTable tbody');
  if (appData.contracts.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#999;padding:40px">ğŸ“‹ Ù‡Ù†ÙˆØ² Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>';
    return;
  }
  
  tbody.innerHTML = appData.contracts.map(contract => `
    <tr>
      <td>${contract.customer || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td style="font-weight:bold;color:#27ae60">${(contract.amount || 0).toLocaleString()}</td>
      <td>${contract.date || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td>
        <button class="btn btn-small btn-danger" onclick="deleteContract('${contract.id}')" style="padding:8px 16px !important;font-size:12px !important">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </td>
    </tr>
  `).join('');
}

function addContract() {
  const customer = document.getElementById('contractCustomer').value.trim();
  const amount = parseInt(document.getElementById('contractAmount').value) || 0;
  const date = document.getElementById('contractDate').value || new Date().toLocaleDateString('fa-IR');
  
  if (!customer || amount <= 0) {
    alert('âŒ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ùˆ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
    return;
  }
  
  appData.contracts.unshift({
    id: Date.now().toString(),
    customer,
    amount,
    date
  });
  
  saveData();
  loadContractsTable();
  loadDashboard();
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
  document.getElementById('contractCustomer').value = '';
  document.getElementById('contractAmount').value = '';
  
  showNotification('âœ… Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
}

function deleteContract(id) {
  if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
    appData.contracts = appData.contracts.filter(c => c.id !== id);
    saveData();
    loadContractsTable();
    loadDashboard();
    showNotification('âœ… Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø­Ø°Ù Ø´Ø¯', 'success');
  }
}

// ==================== Ú†Ú©â€ŒÙ‡Ø§ ====================
function loadChecksTable() {
  const tbody = document.querySelector('#checksTable tbody');
  if (appData.checks.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#999;padding:40px">ğŸ’³ Ù‡Ù†ÙˆØ² Ú†Ú©ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>';
    return;
  }
  
  tbody.innerHTML = appData.checks.map(check => `
    <tr>
      <td><strong>${check.number || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</strong></td>
      <td style="color:#27ae60;font-weight:bold">${(check.amount || 0).toLocaleString()}</td>
      <td>${check.bank || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td>${check.dueDate || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td>
        <span style="padding:8px 16px;border-radius:20px;background:#d4edda;color:#155724;font-weight:bold;font-size:14px">
          ${check.status || 'Ø¬Ø§Ø±ÛŒ'}
        </span>
      </td>
      <td>
        <button class="btn btn-small btn-danger" onclick="deleteCheck('${check.id}')" style="padding:8px 16px !important;font-size:12px !important">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </td>
    </tr>
  `).join('');
}

function addCheck() {
  const number = document.getElementById('checkNumber').value.trim();
  const amount = parseInt(document.getElementById('checkAmount').value) || 0;
  const bank = document.getElementById('checkBank').value.trim();
  const dueDate = document.getElementById('checkDueDate').value;
  const status = document.getElementById('checkStatus').value;
  
  if (!number || amount <= 0) {
    alert('âŒ Ø´Ù…Ø§Ø±Ù‡ Ú†Ú© Ùˆ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
    return;
  }
  
  appData.checks.unshift({
    id: Date.now().toString(),
    number,
    amount,
    bank,
    dueDate,
    status
  });
  
  saveData();
  loadChecksTable();
  loadDashboard();
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
  document.getElementById('checkNumber').value = '';
  document.getElementById('checkAmount').value = '';
  document.getElementById('checkBank').value = '';
  
  showNotification('âœ… Ú†Ú© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
}

function deleteCheck(id) {
  if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
    appData.checks = appData.checks.filter(c => c.id !== id);
    saveData();
    loadChecksTable();
    loadDashboard();
    showNotification('âœ… Ú†Ú© Ø­Ø°Ù Ø´Ø¯', 'success');
  }
}

// ==================== Ù…Ø§Ù„ÛŒ ====================
function loadFinancesTable() {
  const tbody = document.querySelector('#financesTable tbody');
  if (appData.finances.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#999;padding:40px">ğŸ’° Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>';
    return;
  }
  
  tbody.innerHTML = appData.finances.map(finance => `
    <tr style="background:${finance.type === 'income' ? '#d4f4dc' : '#fce4d6'}">
      <td>${finance.desc || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td style="color:${finance.type === 'income' ? '#27ae60' : '#e74c3c'};font-weight:bold">
        ${(finance.amount || 0).toLocaleString()}
      </td>
      <td>
        <span style="padding:8px 16px;border-radius:20px;font-weight:bold;
              ${finance.type === 'income' ? 'background:#d4edda;color:#155724' : 'background:#f8d7da;color:#721c24'}">
          ${finance.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}
        </span>
      </td>
      <td>${finance.date || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
      <td>
        <button class="btn btn-small btn-danger" onclick="deleteFinance('${finance.id}')" style="padding:8px 16px !important;font-size:12px !important">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </td>
    </tr>
  `).join('');
}

function addFinance() {
  const desc = document.getElementById('financeDesc').value.trim();
  const amount = parseInt(document.getElementById('financeAmount').value) || 0;
  const type = document.getElementById('financeType').value;
  
  if (!desc || amount <= 0) {
    alert('âŒ Ø´Ø±Ø­ Ùˆ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
    return;
  }
  
  appData.finances.unshift({
    id: Date.now().toString(),
    desc,
    amount,
    type,
    date: new Date().toLocaleDateString('fa-IR')
  });
  
  saveData();
  loadFinancesTable();
  loadDashboard();
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
  document.getElementById('financeDesc').value = '';
  document.getElementById('financeAmount').value = '';
  
  showNotification(`âœ… ${type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'} Ø«Ø¨Øª Ø´Ø¯`, 'success');
}

function deleteFinance(id) {
  if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
    appData.finances = appData.finances.filter(f => f.id !== id);
    saveData();
    loadFinancesTable();
    loadDashboard();
    showNotification('âœ… ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø°Ù Ø´Ø¯', 'success');
  }
}

// ==================== Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ ====================
function downloadBackup() {
  try {
    const dataStr = JSON.stringify(appData, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `kaleshi-backup-${new Date().toISOString().slice(0,10)}.json`;
    link.click();
    URL.revokeObjectURL(url);
    showNotification('âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯', 'success');
  } catch (e) {
    showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯', 'error');
  }
}

function restoreBackup(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedData = JSON.parse(e.target.result);
      if (confirm('âš ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ù¾Ø§Ú© Ùˆ Ø¨Ø§ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆØ¯ØŸ')) {
        appData = importedData;
        saveData();
        loadAllData();
        updateSystemInfo();
        showNotification('âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚!', 'success');
      }
    } catch (err) {
      showNotification('âŒ ÙØ§ÛŒÙ„ JSON Ø®Ø±Ø§Ø¨ Ø§Ø³Øª', 'error');
    }
  };
  reader.readAsText(file);
}

function clearAllData() {
  if (confirm('âš ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ\n(ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª)')) {
    localStorage.removeItem('kaleshi_v5');
    appData = { contracts: [], checks: [], finances: [], version: '5.0', created: new Date().toISOString() };
    loadAllData();
    updateSystemInfo();
    showNotification('ğŸ—‘ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯', 'success');
  }
}

function exportExcel() {
  showNotification('ğŸ“Š ÙˆÛŒÚ˜Ú¯ÛŒ Ø§Ú©Ø³Ù„ Ø¨Ø²ÙˆØ¯ÛŒ...', 'info');
}

// ==================== Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù† ====================
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position:fixed;top:20px;left:20px;right:20px;max-width:400px;
    background:${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
    color:${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
    padding:20px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);
    z-index:10000;font-weight:bold;border-right:6px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
    animation:slideIn 0.4s ease-out;
  `;
  notification.innerHTML = `
    ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
    <button onclick="this.parentElement.remove()" style="float:left;background:none;border:none;font-size:24px;cursor:pointer;color:inherit;margin-top:-5px">&times;</button>
  `;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, 5000);
}

// ==================== Ø³ÛŒØ³ØªÙ… ====================
function updateDateTime() {
  const now = new Date();
  document.getElementById('currentDate').textContent = now.toLocaleDateString('fa-IR') + ' - ' + now.toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'});
}

function updateSystemInfo() {
  document.getElementById('sysContracts').textContent = appData.contracts.length;
  document.getElementById('sysChecks').textContent = appData.checks.length;
  document.getElementById('sysFinances').textContent = appData.finances.length;
  document.getElementById('sysSize').textContent = Math.round(JSON.stringify(appData).length / 1024) + 'KB';
}

function showPage(pageId) {
  document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
  
  document.getElementById(pageId).classList.add('active');
  event.target.classList.add('active');
  
  if (pageId === 'backup') {
    updateSystemInfo();
  }
}

function logoutApp() {
  if (confirm('ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…ØŸ')) {
    localStorage.removeItem('kaleshi_v5');
    location.reload();
  }
}

// ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ====================
window.addEventListener('load', function() {
  console.log('ğŸš€ Kaleshi v5.0 loaded');
  document.getElementById('password').focus();
  
  // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù†
  updateDateTime();
  setInterval(updateDateTime, 30000);
});

// ==================== Ø³Ø±ÙˆÛŒØ³ ÙˆØ±Ú©Ø± Ø¨Ø±Ø§ÛŒ PWA ====================
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
    self.addEventListener('install', e => {
      self.skipWaiting();
    });
    self.addEventListener('activate', e => {
      self.clients.claim();
    });
    self.addEventListener('fetch', e => {
      e.respondWith(fetch(e.request));
    });
  `));
}
</script>

</body>
</html>
