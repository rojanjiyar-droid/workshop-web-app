<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ… v14 - Ú©Ø§Ù…Ù„ Ùˆ Ø³Ø§Ø¯Ù‡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Tahoma, Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
            min-height: 100vh; direction: rtl; 
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .btn { 
            background: #3b82f6; color: white; border: none; padding: 12px 20px; 
            border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px;
            transition: all 0.3s;
        }
        .btn:hover { background: #1d4ed8; transform: translateY(-2px); }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-control { 
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; 
            font-size: 15px; font-family: inherit;
        }
        .form-control:focus { border-color: #3b82f6; outline: none; }
        
        .card { 
            background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .card-header { 
            background: linear-gradient(135deg, #1e3a8a, #3b82f6); 
            color: white; padding: 15px 20px; border-radius: 8px 8px 0 0; 
            margin: -20px -20px 20px -20px;
        }
        
        .stats-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin: 20px 0;
        }
        .stat-card { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; 
            padding: 20px; border-radius: 12px; text-align: center;
        }
        .stat-value { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        
        .table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .table th, .table td { padding: 12px; text-align: right; border-bottom: 1px solid #eee; }
        .table th { background: #1e3a8a; color: white; font-weight: bold; }
        .table tr:hover { background: #f8f9ff; }
        
        .login-container { 
            min-height: 100vh; display: flex; align-items: center; justify-content: center; 
            padding: 40px 20px;
        }
        .login-card { 
            background: white; border-radius: 20px; padding: 40px; width: 100%; max-width: 400px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .login-logo { 
            width: 80px; height: 80px; margin: 0 auto 20px; 
            background: linear-gradient(135deg, #1e3a8a, #3b82f6); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            color: white; font-size: 24px; font-weight: bold;
        }
        
        .main-nav { 
            background: #0f172a; display: flex; overflow-x: auto; padding: 0; 
            border-radius: 12px; margin-bottom: 20px;
        }
        .nav-btn { 
            background: none; border: none; color: white; padding: 15px 20px; 
            cursor: pointer; white-space: nowrap; transition: all 0.3s;
        }
        .nav-btn:hover, .nav-btn.active { background: #3b82f6; }
        
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .product-row { 
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; 
            padding: 15px; background: #f8fafc; border-radius: 8px; margin-bottom: 10px;
        }
        .totals-box { 
            background: linear-gradient(135deg, #10b981, #059669); color: white; 
            padding: 20px; border-radius: 12px; margin: 20px 0;
        }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        
        .notification { 
            position: fixed; top: 20px; right: 20px; background: white; padding: 15px 20px; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            border-right: 5px solid #10b981; z-index: 1000;
        }
        
        @media (max-width: 768px) { 
            .form-row, .product-row { grid-template-columns: 1fr; } 
            .main-nav { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Ø§Ø¹Ù„Ø§Ù†Ø§Øª -->
    <div id="notifications"></div>

    <!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-logo">CF</div>
            <h2 style="text-align: center; margin-bottom: 30px; color: #1e3a8a;">Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</h2>
            
            <div class="form-group">
                <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                <input type="text" id="username" class="form-control" value="admin" style="text-align: right;">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                <input type="password" id="password" class="form-control" value="1234" style="text-align: right;">
            </div>
            
            <button class="btn" style="width: 100%; margin-top: 20px;" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</button>
            
            <div style="margin-top: 20px; text-align: center; font-size: 14px; color: #666;">
                Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: admin | Ø±Ù…Ø²: 1234
            </div>
        </div>
    </div>

    <!-- Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ -->
    <div id="mainApp" style="display: none;">
        <header style="background: #0f172a; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #3b82f6; font-weight: bold; font-size: 20px;">CF</div>
                <div>
                    <h3 style="margin: 0; font-size: 18px;">Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</h3>
                    <div id="currentDate" style="font-size: 13px; opacity: 0.8;"></div>
                </div>
            </div>
            <div>
                <span id="userName" style="margin-right: 15px;"></span>
                <button class="btn btn-danger btn-sm" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <nav class="main-nav" id="mainNav">
            <button class="nav-btn active" onclick="showPage('dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            <button class="nav-btn" onclick="showPage('contracts')">ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</button>
            <button class="nav-btn" onclick="showPage('customers')">ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
            <button class="nav-btn" onclick="showPage('checks')">ğŸ¦ Ú†Ú©â€ŒÙ‡Ø§</button>
        </nav>

        <div class="container">
            <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div id="dashboard" class="page active">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…</h3>
                        <button class="btn btn-success btn-sm" onclick="updateDashboard()">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                    </div>
                    <div class="stats-grid" id="statsGrid">
                        <!-- Ø¢Ù…Ø§Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                </div>
            </div>

            <!-- Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ -->
            <div id="contracts" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“ Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
                        <button class="btn btn-warning btn-sm" onclick="resetContract()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ *</label>
                            <input type="text" id="contractCustomer" class="form-control" list="customerList">
                        </div>
                        <div class="form-group">
                            <label>ØªÙ„ÙÙ†</label>
                            <input type="tel" id="contractPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Ø¢Ø¯Ø±Ø³</label>
                            <input type="text" id="contractAddress" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÛŒØ® Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</label>
                            <input type="text" id="contractDate" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„</label>
                            <input type="text" id="deliveryDate" class="form-control">
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px 0; color: #1e3a8a;">ğŸ“¦ Ù…Ø­ØµÙˆÙ„Ø§Øª</h4>
                    <div id="productsContainer"></div>
                    <button class="btn btn-info btn-sm" onclick="addProduct()">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø­ØµÙˆÙ„</button>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>Ù…Ø¨Ù„Øº Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª</label>
                        <input type="number" id="advancePayment" class="form-control" value="0" oninput="calculateTotal()">
                    </div>

                    <h4 style="margin: 20px 0 10px 0; color: #1e3a8a;">ğŸ¦ Ú†Ú©â€ŒÙ‡Ø§</h4>
                    <div id="checksContainer"></div>
                    <button class="btn btn-info btn-sm" onclick="addCheck()">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú†Ú©</button>

                    <div class="totals-box">
                        <div class="total-row">
                            <span>Ø¬Ù…Ø¹ Ù…Ø­ØµÙˆÙ„Ø§Øª:</span>
                            <strong id="totalProducts">0 ØªÙˆÙ…Ø§Ù†</strong>
                        </div>
                        <div class="total-row">
                            <span>Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª:</span>
                            <strong id="totalAdvance">0 ØªÙˆÙ…Ø§Ù†</strong>
                        </div>
                        <div class="total-row">
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ú†Ú©â€ŒÙ‡Ø§:</span>
                            <strong id="totalChecks">0 ØªÙˆÙ…Ø§Ù†</strong>
                        </div>
                        <div class="total-row" style="font-size: 18px; font-weight: bold; color: #ffd700;">
                            <span>ğŸŸ¢ Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨:</span>
                            <strong id="remainingBalance">0 ØªÙˆÙ…Ø§Ù†</strong>
                        </div>
                    </div>

                    <div style="text-align: left; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveContract()">âœ… Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
                        <button class="btn btn-primary" onclick="printContract()">ğŸ–¨ï¸ Ú†Ø§Ù¾ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header"><h3>ğŸ“‹ Ù„ÛŒØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</h3></div>
                    <div style="overflow-x: auto;">
                        <table class="table" id="contractsTable">
                            <thead>
                                <tr>
                                    <th>Ø´Ù…Ø§Ø±Ù‡</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº Ú©Ù„</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø´ØªØ±ÛŒØ§Ù† -->
            <div id="customers" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>
                        <button class="btn btn-success btn-sm" onclick="showCustomerForm()">â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</button>
                    </div>
                    
                    <div id="customerForm" style="display: none; background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ *</label>
                                <input type="text" id="newCustomerName" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>ØªÙ„ÙÙ† *</label>
                                <input type="tel" id="newCustomerPhone" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Ø¢Ø¯Ø±Ø³</label>
                                <input type="text" id="newCustomerAddress" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ</label>
                                <select id="newCustomerType" class="form-control">
                                    <option value="Ø¹Ø§Ø¯ÛŒ">Ø¹Ø§Ø¯ÛŒ</option>
                                    <option value="Ù¾ÛŒØ´ Ø®Ø±ÛŒØ¯">Ù¾ÛŒØ´ Ø®Ø±ÛŒØ¯</option>
                                    <option value="Ø¹Ø§Ù…Ù„">Ø¹Ø§Ù…Ù„</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="saveNewCustomer()">Ø°Ø®ÛŒØ±Ù‡</button>
                        <button class="btn btn-warning" onclick="hideCustomerForm()">Ø§Ù†ØµØ±Ø§Ù</button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table class="table" id="customersTable">
                            <thead>
                                <tr><th>Ù†Ø§Ù…</th><th>ØªÙ„ÙÙ†</th><th>Ø¢Ø¯Ø±Ø³</th><th>Ù†ÙˆØ¹</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ú†Ú©â€ŒÙ‡Ø§ -->
            <div id="checks" class="page">
                <div class="card">
                    <div class="card-header"><h3>ğŸ¦ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ú©â€ŒÙ‡Ø§</h3></div>
                    <div style="overflow-x: auto;">
                        <table class="table" id="checksTable">
                            <thead>
                                <tr><th>Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ø³Ø±Ø±Ø³ÛŒØ¯</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <datalist id="customerList"></datalist>

    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        let appData = JSON.parse(localStorage.getItem('kaleshiData')) || {
            customers: [
                {id: 1, name: 'Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ', phone: '09121234567', address: 'Ø§Ø±ÙˆÙ…ÛŒÙ‡ - Ø¨Ù„ÙˆØ§Ø± Ø¢Ø²Ø§Ø¯ÛŒ', type: 'Ø¹Ø§Ø¯ÛŒ'},
                {id: 2, name: 'Ø±Ø¶Ø§ Ø§Ø­Ù…Ø¯ÛŒ', phone: '09129876543', address: 'Ø§Ø±ÙˆÙ…ÛŒÙ‡ - Ù‚Ø²Ù„ Ø¹Ø§Ø´Ù‚', type: 'Ø¹Ø§Ù…Ù„'}
            ],
            contracts: [],
            checks: []
        };

        let currentUser = null;
        let productCounter = 0;
        let checkCounter = 0;

        // ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø³Ø§Ø¯Ù‡
        function getPersianDate() {
            const now = new Date();
            const persianDigits = 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹';
            let dateStr = now.toLocaleDateString('fa-IR');
            return dateStr.replace(/\d/g, d => persianDigits[parseInt(d)]);
        }

        // ÙØ±Ù…Øª Ø§Ø¹Ø¯Ø§Ø¯
        function formatNumber(num) {
            return num.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
        }

        // Ø§Ø¹Ù„Ø§Ù†
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderRightColor = type === 'success' ? '#10b981' : '#ef4444';
            notification.innerHTML = `
                <span style="font-size: 20px;">${type === 'success' ? 'âœ…' : 'âŒ'}</span>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
            `;
            document.getElementById('notifications').appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        // ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… - ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡ Ø³Ø§Ø¯Ù‡
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === '1234') {
                currentUser = 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…';
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userName').textContent = currentUser;
                document.getElementById('currentDate').textContent = getPersianDate();
                document.getElementById('contractDate').value = getPersianDate();
                initApp();
                showNotification('Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!');
            } else {
                showNotification('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!', 'error');
            }
        }

        function logout() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                location.reload();
            }
        }

        function showPage(pageId) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            // Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
            if (pageId === 'contracts') loadContracts();
            if (pageId === 'customers') loadCustomers();
            if (pageId === 'checks') loadChecks();
        }

        function initApp() {
            updateDashboard();
            loadCustomers();
            resetContractForm();
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('loginPage').style.display !== 'none') {
                    login();
                }
            });
        }

        // Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        function updateDashboard() {
            const totalContracts = appData.contracts.length;
            const totalRevenue = appData.contracts.reduce((sum, contract) => {
                return sum + contract.products.reduce((pSum, product) => pSum + (product.qty * product.price), 0);
            }, 0);
            
            const totalYunolit = appData.contracts.reduce((sum, contract) => {
                return sum + contract.products.filter(p => p.type === 'ÛŒÙˆÙ†ÙˆÙ„ÛŒØª').reduce((pSum, p) => pSum + (p.qty * p.price), 0);
            }, 0);
            
            const totalOragh = appData.contracts.reduce((sum, contract) => {
                return sum + contract.products.filter(p => p.type === 'ÙˆØ±Ù‚').reduce((pSum, p) => pSum + (p.qty * p.price), 0);
            }, 0);
            
            const totalPanel = appData.contracts.reduce((sum, contract) => {
                return sum + contract.products.filter(p => p.type === 'Ù¾Ø§Ù†Ù„').reduce((pSum, p) => pSum + (p.qty * p.price), 0);
            }, 0);
            
            const totalCustomers = appData.customers.length;
            const pendingChecks = appData.checks.filter(check => check.status !== 'ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡').length;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalContracts}</div>
                    <div>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <div class="stat-value">${formatNumber(totalRevenue)}</div>
                    <div>Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <div class="stat-value">${pendingChecks}</div>
                    <div>Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div class="stat-value">${totalCustomers}</div>
                    <div>Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                    <div class="stat-value">${formatNumber(totalYunolit)}</div>
                    <div>ÛŒÙˆÙ†ÙˆÙ„ÛŒØª</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                    <div class="stat-value">${formatNumber(totalOragh)}</div>
                    <div>ÙˆØ±Ù‚</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ec4899, #db2777);">
                    <div class="stat-value">${formatNumber(totalPanel)}</div>
                    <div>Ù¾Ø§Ù†Ù„</div>
                </div>
            `;
        }

        // Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§...
        function resetContractForm() {
            document.getElementById('contractCustomer').value = '';
            document.getElementById('contractPhone').value = '';
            document.getElementById('contractAddress').value = '';
            document.getElementById('deliveryDate').value = '';
            document.getElementById('advancePayment').value = '0';
            document.getElementById('productsContainer').innerHTML = '';
            document.getElementById('checksContainer').innerHTML = '';
            productCounter = 0;
            checkCounter = 0;
            addProduct();
            addCheck();
            calculateTotal();
        }

        function addProduct() {
            const container = document.getElementById('productsContainer');
            const id = productCounter++;
            container.innerHTML += `
                <div class="product-row">
                    <select id="prodType${
