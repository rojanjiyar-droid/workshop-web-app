<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒ ÙÙˆÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
  <style>
    /* Ø§ÛŒÙ†Ø¬Ø§ ØªÙ…Ø§Ù… Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ */
    /* Ø¨Ø±Ø§ÛŒ Ø§Ø®ØªØµØ§Ø±ØŒ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¯Ø± ÙØ§ÛŒÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯ */
    body {
      font-family: 'Tahoma', 'Vazir', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1400px;
      margin: auto;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; color: white; }
    .btn-success { background: #27ae60; }
    .btn-info { background: #3498db; }
    .btn-warning { background: #f39c12; }
    .btn-danger { background: #e74c3c; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;
    }
    .alert { padding: 10px; margin: 10px 0; border-radius: 5px; }
    .alert-success { background: #d4edda; color: #155724; }
    .alert-danger { background: #f8d7da; color: #721c24; }
    .alert-warning { background: #fff3cd; color: #856404; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒ ÙÙˆÙ…</h1>
    <div class="nav">
      <button onclick="showTab('dashboard')" class="btn btn-info">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
      <button onclick="showTab('contracts')" class="btn btn-success">ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
      <button onclick="showTab('expenses')" class="btn btn-warning">ğŸ’° Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</button>
      <button onclick="showTab('backup')" class="btn btn-danger">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
    </div>

    <div id="dashboard" class="tab-content active">
      <h2>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ</h2>
      <canvas id="financeChart" height="100"></canvas>
      <div id="checkAlerts"></div>
    </div>

    <div id="contracts" class="tab-content">
      <h2>ğŸ“ Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</h2>
      <div class="form-group">
        <label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</label>
        <input type="text" id="contractCustomer">
      </div>
      <div class="form-group">
        <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
        <input type="text" id="contractPhone">
      </div>
      <div class="form-group">
        <label>Ù¾ÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
        <input type="number" id="contractAdvance">
      </div>
      <button class="btn btn-success" onclick="addContract()">Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
    </div>

    <div id="expenses" class="tab-content">
      <h2>ğŸ’° Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡</h2>
      <div class="form-group">
        <label>Ù†ÙˆØ¹ Ù‡Ø²ÛŒÙ†Ù‡</label>
        <select id="expenseType">
          <option value="material">Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</option>
          <option value="salary">Ø­Ù‚ÙˆÙ‚</option>
        </select>
      </div>
      <div class="form-group">
        <label>Ù…Ø¨Ù„Øº</label>
        <input type="number" id="expenseAmount">
      </div>
      <button class="btn btn-warning" onclick="addExpense()">Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡</button>
    </div>

    <div id="backup" class="tab-content">
      <h2>ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h2>
      <button class="btn btn-info" onclick="backupData()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
      <input type="file" onchange="handleBackupFile(this.files)">
      <button class="btn btn-danger" onclick="restoreBackup()">ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
    </div>
  </div>

  <script>
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    let contracts = [], expenses = [];

    function showTab(id) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function showAlert(msg, type = 'success') {
      const alert = document.createElement('div');
      alert.className = 'alert alert-' + type;
      alert.textContent = msg;
      document.querySelector('.container').prepend(alert);
      setTimeout(() => alert.remove(), 4000);
    }

    function addContract() {
      const customer = document.getElementById('contractCustomer').value.trim();
      const phone = document.getElementById('contractPhone').value.trim();
      const advance = parseFloat(document.getElementById('contractAdvance').value) || 0;
      if (!customer || !/^09\d{9}$/.test(phone)) {
        showAlert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª', 'danger'); return;
      }
      contracts.push({ customer, phone, advance });
      saveAllData();
      showAlert('Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø«Ø¨Øª Ø´Ø¯');
    }

    function addExpense() {
      const type = document.getElementById('expenseType').value;
      const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
      if (amount <= 0) {
        showAlert('Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª', 'danger'); return;
      }
      expenses.push({ type, amount });
      saveAllData();
      showAlert('Ù‡Ø²ÛŒÙ†Ù‡ Ø«Ø¨Øª Ø´Ø¯');
    }

    function saveAllData() {
      const data = { contracts, expenses };
      localStorage.setItem('foamData', btoa(JSON.stringify(data)));
    }

    function loadAllData() {
      const raw = localStorage.getItem('foamData');
      if (raw) {
        const data = JSON.parse(atob(raw));
        contracts = data.contracts || [];
        expenses = data.expenses || [];
      }
    }

    function backupData() {
      const dataStr = JSON.stringify({ contracts, expenses }, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'backup.json';
      link.click();
      showAlert('Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
    }

    function handleBackupFile(files) {
      const reader = new FileReader();
      reader.onload = e => {
        localStorage.setItem('pendingBackup', e.target.result);
        showAlert('ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯. Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯');
      };
      reader.readAsText(files[0]);
    }

    function restoreBackup() {
      const raw = localStorage.getItem('pendingBackup');
      if (!raw) return showAlert('ÙØ§ÛŒÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†ÛŒØ³Øª', 'danger');
      const data = JSON.parse(raw);
      contracts = data.contracts || [];
      expenses = data.expenses || [];
      saveAllData();
      showAlert('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù†Ø¯');
    }

    function initCharts() {
      const ctx = document.getElementById('financeChart').getContext('2d');
      const income
