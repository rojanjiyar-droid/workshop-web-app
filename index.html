<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ… v6.0 - Ú©Ø§Ù…Ù„</title>
<style>
body{font-family:Tahoma;background:#f0f8ff;color:#333;padding:10px;text-align:center}
.login{max-width:400px;margin:50px auto;background:white;padding:40px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
input{width:100%;padding:15px;margin:10px 0;border:2px solid #ddd;border-radius:10px;font-size:18px;box-sizing:border-box}
button{width:100%;padding:15px;background:#27ae60;color:white;border:none;border-radius:10px;font-size:20px;font-weight:bold;cursor:pointer}
button:hover{background:#219a52}
.app{display:none;background:white;padding:20px;border-radius:20px;max-width:100%;margin:10px auto;box-shadow:0 10px 30px rgba(0,0,0,0.1)}
header{background:#3498db;color:white;padding:20px;border-radius:10px 10px 0 0}
nav{display:flex;background:#2c3e50;padding:10px;border-radius:10px 10px 0 0;overflow-x:auto;flex-wrap:wrap}
.navbtn{background:none;color:white;border:none;padding:12px 15px;cursor:pointer;flex:1;font-size:14px;min-width:120px}
.navbtn.active{background:#3498db}
.content{padding:20px;min-height:400px}
.page{display:none}
.page.active{display:block}
table{width:100%;border-collapse:collapse;margin:20px 0}
th,td{padding:12px;text-align:right;border-bottom:1px solid #eee}
th{background:#34495e;color:white}
tr:hover{background:#f0f8ff}
.stats{display:grid;grid-template-columns:repeat(auto-fit,1fr);gap:15px;margin:20px 0}
.stat{background:#e8f5e8;padding:20px;border-radius:10px;text-align:center}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,1fr);gap:15px;margin:20px 0}
input,select{padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px;width:100%;box-sizing:border-box}
.btn-small{padding:10px 20px;background:#27ae60;color:white;border:none;border-radius:8px;cursor:pointer;font-size:14px;margin:5px}
.btn-del{background:#e74c3c}
@media (max-width:600px){.navbtn{font-size:12px;padding:10px}}
</style>
</head>
<body>

<div class="login">
<h1 style="color:#2c3e50">ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ… v6.0</h1>
<input id="user" value="admin" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
<input id="pass" type="password" value="1234" placeholder="Ø±Ù…Ø²">
<button onclick="login()">ğŸš€ ÙˆØ±ÙˆØ¯</button>
<div style="margin-top:20px;color:#666;font-size:14px">
<b>admin / 1234</b> - Enter Ø¨Ø²Ù†!
</div>
</div>

<div class="app" id="app">
<header>
<h2 style="margin:0;display:inline-block">ğŸ­ Ú©Ù„Ø´ÛŒÙÙˆÙ…</h2>
<div id="date" style="float:right;font-size:14px;margin-top:10px"></div>
<span id="userwelcome" style="float:left;margin-left:20px"></span>
<button onclick="logout()" style="float:left;background:#e74c3c;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;font-size:14px">Ø®Ø±ÙˆØ¬</button>
</header>

<nav>
<button class="navbtn active" onclick="show('dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
<button class="navbtn" onclick="show('contracts')">ğŸ“‹ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</button>
<button class="navbtn" onclick="show('invoices')">ğŸ§¾ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</button>
<button class="navbtn" onclick="show('customers')">ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
<button class="navbtn" onclick="show('workers')">ğŸ‘· Ú©Ø§Ø±Ú©Ù†Ø§Ù†</button>
<button class="navbtn" onclick="show('checks')">ğŸ’³ Ú†Ú©â€ŒÙ‡Ø§</button>
<button class="navbtn" onclick="show('finances')">ğŸ’° Ù…Ø§Ù„ÛŒ</button>
<button class="navbtn" onclick="show('expenses')">ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</button>
<button class="navbtn" onclick="show('reports')">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´Ø§Øª</button>
<button class="navbtn" onclick="show('backup')">â˜ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
</nav>

<div class="content">
<!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
<div id="dashboard" class="page active">
<div class="stats">
<div class="stat"><div style="font-size:32px;color:#27ae60" id="totContracts">0</div>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</div>
<div class="stat"><div style="font-size:32px;color:#f39c12" id="totInvoices">0</div>ÙØ§Ú©ØªÙˆØ±</div>
<div class="stat"><div style="font-size:32px;color:#3498db" id="totCustomers">0</div>Ù…Ø´ØªØ±ÛŒ</div>
<div class="stat"><div style="font-size:32px;color:#9b59b6" id="totWorkers">0</div>Ú©Ø§Ø±Ù…Ù†Ø¯</div>
<div class="stat"><div style="font-size:32px;color:#e67e22" id="totChecks">0</div>Ú†Ú©</div>
<div class="stat"><div style="font-size:32px;color:#27ae60" id="balance">0</div>ØªØ±Ø§Ø²</div>
</div>
<button onclick="backup()" class="btn-small" style="width:100%;padding:15px;font-size:18px">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø³Ø±ÛŒØ¹</button>
</div>

<!-- Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ -->
<div id="contracts" class="page">
<h3>ğŸ“‹ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
<div class="form-grid">
<input id="conCustomer" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
<input id="conAmount" type="number" placeholder="Ù…Ø¨Ù„Øº">
<input id="conDate" type="date">
</div>
<button onclick="addContract()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
<table id="conTable"><thead><tr><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ -->
<div id="invoices" class="page">
<h3>ğŸ§¾ ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ±</h3>
<div class="form-grid">
<input id="invCustomer" placeholder="Ù…Ø´ØªØ±ÛŒ">
<input id="invAmount" type="number" placeholder="Ù…Ø¨Ù„Øº">
<select id="invType"><option>Ù†Ù‚Ø¯ÛŒ</option><option>Ú†Ú©ÛŒ</option><option>Ù†Ø³ÛŒÙ‡</option></select>
</div>
<button onclick="addInvoice()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ±</button>
<table id="invTable"><thead><tr><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ù…Ø´ØªØ±ÛŒØ§Ù† -->
<div id="customers" class="page">
<h3>ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>
<div class="form-grid">
<input id="cusName" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
<input id="cusPhone" placeholder="ØªÙ„ÙÙ†">
<input id="cusAddress" placeholder="Ø¢Ø¯Ø±Ø³">
</div>
<button onclick="addCustomer()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</button>
<table id="cusTable"><thead><tr><th>Ù†Ø§Ù…</th><th>ØªÙ„ÙÙ†</th><th>Ø¢Ø¯Ø±Ø³</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ú©Ø§Ø±Ú©Ù†Ø§Ù† -->
<div id="workers" class="page">
<h3>ğŸ‘· Ú©Ø§Ø±Ú©Ù†Ø§Ù†</h3>
<div class="form-grid">
<input id="worName" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯">
<input id="worJob" placeholder="Ø³Ù…Øª">
<input id="worSalary" type="number" placeholder="Ø­Ù‚ÙˆÙ‚">
</div>
<button onclick="addWorker()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</button>
<table id="worTable"><thead><tr><th>Ù†Ø§Ù…</th><th>Ø³Ù…Øª</th><th>Ø­Ù‚ÙˆÙ‚</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ú†Ú©â€ŒÙ‡Ø§ -->
<div id="checks" class="page">
<h3>ğŸ’³ Ú†Ú©â€ŒÙ‡Ø§</h3>
<div class="form-grid">
<input id="chkNumber" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©">
<input id="chkAmount" type="number" placeholder="Ù…Ø¨Ù„Øº">
<input id="chkBank" placeholder="Ø¨Ø§Ù†Ú©">
<input id="chkDate" type="date">
<select id="chkStatus"><option>Ø¬Ø§Ø±ÛŒ</option><option>ÙˆØµÙˆÙ„</option><option>Ø¨Ø±Ú¯Ø´ØªÛŒ</option></select>
</div>
<button onclick="addCheck()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ø«Ø¨Øª Ú†Ú©</button>
<table id="chkTable"><thead><tr><th>Ø´Ù…Ø§Ø±Ù‡</th><th>Ù…Ø¨Ù„Øº</th><th>Ø¨Ø§Ù†Ú©</th><th>Ø³Ø±Ø±Ø³ÛŒØ¯</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ù…Ø§Ù„ÛŒ -->
<div id="finances" class="page">
<h3>ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯/Ù‡Ø²ÛŒÙ†Ù‡</h3>
<div class="form-grid">
<input id="finDesc" placeholder="Ø´Ø±Ø­">
<input id="finAmount" type="number" placeholder="Ù…Ø¨Ù„Øº">
<select id="finType"><option value="income">Ø¯Ø±Ø¢Ù…Ø¯</option><option value="expense">Ù‡Ø²ÛŒÙ†Ù‡</option></select>
</div>
<button onclick="addFinance()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ø«Ø¨Øª</button>
<table id="finTable"><thead><tr><th>Ø´Ø±Ø­</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ -->
<div id="expenses" class="page">
<h3>ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø±ÛŒ</h3>
<div class="form-grid">
<input id="expDesc" placeholder="Ù†ÙˆØ¹ Ù‡Ø²ÛŒÙ†Ù‡">
<input id="expAmount" type="number" placeholder="Ù…Ø¨Ù„Øº">
<select id="expCat"><option>Ø§Ø¬Ø§Ø±Ù‡</option><option>Ø­Ù‚ÙˆÙ‚</option><option>Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</option><option>Ø³ÙˆØ®Øª</option><option>Ø³Ø§ÛŒØ±</option></select>
</div>
<button onclick="addExpense()" class="btn-small" style="width:100%;padding:15px;font-size:18px">â• Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡</button>
<table id="expTable"><thead><tr><th>Ø´Ø±Ø­</th><th>Ù…Ø¨Ù„Øº</th><th>Ø¯Ø³ØªÙ‡</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead><tbody></tbody></table>
</div>

<!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
<div id="reports" class="page">
<h3>ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ú©Ø§Ù…Ù„</h3>
<div style="background:#f0f8ff;padding:20px;border-radius:10px;margin:20px 0">
<div style="display:grid;grid-template-columns:repeat(auto-fit,1fr);gap:20px;font-size:18px">
<div>ğŸ“‹ Ú©Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§: <b id="repContracts">0</b></div>
<div>ğŸ§¾ Ú©Ù„ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§: <b id="repInvoices">0</b></div>
<div>ğŸ’° Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯: <b id="repIncome">0</b> ØªÙˆÙ…Ø§Ù†</div>
<div>ğŸ’¸ Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡: <b id="repExpense">0</b> ØªÙˆÙ…Ø§Ù†</div>
<div>ğŸ’³ Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø±ÛŒ: <b id="repChecks">0</b></div>
<div>ğŸ‘¥ Ú©Ù„ Ù…Ø´ØªØ±ÛŒØ§Ù†: <b id="repCustomers">0</b></div>
</div>
</div>
<button onclick="printReport()" class="btn-small" style="width:100%;padding:15px;font-size:18px;background:#9b59b6">ğŸ–¨ï¸ Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´</button>
</div>

<!-- Ù¾Ø´ØªÛŒØ¨Ø§Ù† -->
<div id="backup" class="page">
<h3>â˜ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h3>
<button onclick="downloadBackup()" class="btn-small" style="width:100%;padding:20px;font-size:18px;background:#3498db">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ JSON</button>
<br><br>
<input type="file" id="backupFile" accept=".json" style="display:none" onchange="restoreBackup(event)">
<button onclick="document.getElementById('backupFile').click()" class="btn-small" style="width:100%;padding:20px;font-size:18px;background:#f39c12">ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
<br><br>
<button onclick="clearAll()" class="btn-small" style="width:100%;padding:20px;font-size:18px;background:#e74c3c">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
<div id="backupInfo" style="margin-top:30px;padding:20px;background:#f0f8ff;border-radius:10px"></div>
</div>
</div>
</div>

<script>
var data=JSON.parse(localStorage.kaleshi||'{"contracts":[],"invoices":[],"customers":[],"workers":[],"checks":[],"finances":[],"expenses":[],"version":"6.0"}');

function login(){
if(document.getElementById('user').value=='admin'&&document.getElementById('pass').value=='1234'){
document.querySelector('.login').style.display='none';
document.getElementById('app').style.display='block';
document.getElementById('userwelcome').innerHTML='Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ admin';
loadAll();
updateDate();
setInterval(updateDate,30000);
}else{alert('âŒ admin / 1234')}
}

function save(){localStorage.kaleshi=JSON.stringify(data)}

function loadAll(){
loadDashboard();
loadContracts();
loadInvoices();
loadCustomers();
loadWorkers();
loadChecks();
loadFinances();
loadExpenses();
loadReports();
loadBackupInfo();
}

function loadDashboard(){
document.getElementById('totContracts').innerHTML=data.contracts.length;
document.getElementById('totInvoices').innerHTML=data.invoices.length;
document.getElementById('totCustomers').innerHTML=data.customers.length;
document.getElementById('totWorkers').innerHTML=data.workers.length;
document.getElementById('totChecks').innerHTML=data.checks.length;
var bal=data.finances.reduce((s,i)=>i.type=='income'?s+i.amount:s-i.amount,0);
document.getElementById('balance').innerHTML=bal.toLocaleString()+' ØªÙˆÙ…Ø§Ù†';
}

function loadContracts(){
var t=document.querySelector('#conTable tbody');
t.innerHTML=data.contracts.map(i=>`<tr><td>${i.customer}</td><td>${i.amount.toLocaleString()}</td><td>${i.date}</td><td><button class="btn-small btn-del" onclick="delContract('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=4>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addContract(){
var c=document.getElementById('conCustomer').value,a=+document.getElementById('conAmount').value,d=document.getElementById('conDate').value||new Date().toLocaleDateString('fa');
if(c&&a){data.contracts.unshift({id:Date.now(),customer:c,amount:a,date:d});save();loadContracts();loadDashboard();alert('âœ…');document.getElementById('conCustomer').value='';document.getElementById('conAmount').value='';}}
function delContract(id){if(confirm('Ø­Ø°ÙØŸ')){data.contracts=data.contracts.filter(i=>i.id!=id);save();loadContracts();loadDashboard();}}

function loadInvoices(){
var t=document.querySelector('#invTable tbody');
t.innerHTML=data.invoices.map(i=>`<tr><td>${i.customer}</td><td>${i.amount.toLocaleString()}</td><td>${i.type}</td><td>${i.date}</td><td><button class="btn-small btn-del" onclick="delInvoice('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=5>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addInvoice(){
var c=document.getElementById('invCustomer').value,a=+document.getElementById('invAmount').value,t=document.getElementById('invType').value,d=new Date().toLocaleDateString('fa');
if(c&&a){data.invoices.unshift({id:Date.now(),customer:c,amount:a,type:t,date:d});save();loadInvoices();loadDashboard();alert('âœ…');document.getElementById('invCustomer').value='';document.getElementById('invAmount').value='';}}
function delInvoice(id){if(confirm('Ø­Ø°ÙØŸ')){data.invoices=data.invoices.filter(i=>i.id!=id);save();loadInvoices();loadDashboard();}}

function loadCustomers(){
var t=document.querySelector('#cusTable tbody');
t.innerHTML=data.customers.map(i=>`<tr><td>${i.name}</td><td>${i.phone}</td><td>${i.address}</td><td><button class="btn-small btn-del" onclick="delCustomer('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=4>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addCustomer(){
var n=document.getElementById('cusName').value,p=document.getElementById('cusPhone').value,a=document.getElementById('cusAddress').value;
if(n){data.customers.unshift({id:Date.now(),name:n,phone:p,address:a});save();loadCustomers();loadDashboard();alert('âœ…');document.getElementById('cusName').value='';}}
function delCustomer(id){if(confirm('Ø­Ø°ÙØŸ')){data.customers=data.customers.filter(i=>i.id!=id);save();loadCustomers();loadDashboard();}}

function loadWorkers(){
var t=document.querySelector('#worTable tbody');
t.innerHTML=data.workers.map(i=>`<tr><td>${i.name}</td><td>${i.job}</td><td>${i.salary.toLocaleString()}</td><td><button class="btn-small btn-del" onclick="delWorker('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=4>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addWorker(){
var n=document.getElementById('worName').value,j=document.getElementById('worJob').value,s=+document.getElementById('worSalary').value;
if(n){data.workers.unshift({id:Date.now(),name:n,job:j,salary:s});save();loadWorkers();loadDashboard();alert('âœ…');document.getElementById('worName').value='';}}
function delWorker(id){if(confirm('Ø­Ø°ÙØŸ')){data.workers=data.workers.filter(i=>i.id!=id);save();loadWorkers();loadDashboard();}}

function loadChecks(){
var t=document.querySelector('#chkTable tbody');
t.innerHTML=data.checks.map(i=>`<tr><td>${i.number}</td><td>${i.amount.toLocaleString()}</td><td>${i.bank}</td><td>${i.date}</td><td>${i.status}</td><td><button class="btn-small btn-del" onclick="delCheck('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=6>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addCheck(){
var n=document.getElementById('chkNumber').value,a=+document.getElementById('chkAmount').value,b=document.getElementById('chkBank').value,d=document.getElementById('chkDate').value,s=document.getElementById('chkStatus').value;
if(n&&a){data.checks.unshift({id:Date.now(),number:n,amount:a,bank:b,date:d,status:s});save();loadChecks();loadDashboard();alert('âœ…');document.getElementById('chkNumber').value='';}}
function delCheck(id){if(confirm('Ø­Ø°ÙØŸ')){data.checks=data.checks.filter(i=>i.id!=id);save();loadChecks();loadDashboard();}}

function loadFinances(){
var t=document.querySelector('#finTable tbody');
t.innerHTML=data.finances.map(i=>`<tr><td>${i.desc}</td><td>${i.amount.toLocaleString()}</td><td>${i.type}</td><td>${i.date}</td><td><button class="btn-small btn-del" onclick="delFinance('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=5>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addFinance(){
var d=document.getElementById('finDesc').value,a=+document.getElementById('finAmount').value,t=document.getElementById('finType').value;
if(d&&a){data.finances.unshift({id:Date.now(),desc:d,amount:a,type:t,date:new Date().toLocaleDateString('fa')});save();loadFinances();loadDashboard();alert('âœ…');document.getElementById('finDesc').value='';}}
function delFinance(id){if(confirm('Ø­Ø°ÙØŸ')){data.finances=data.finances.filter(i=>i.id!=id);save();loadFinances();loadDashboard();}}

function loadExpenses(){
var t=document.querySelector('#expTable tbody');
t.innerHTML=data.expenses.map(i=>`<tr><td>${i.desc}</td><td>${i.amount.toLocaleString()}</td><td>${i.category}</td><td>${i.date}</td><td><button class="btn-small btn-del" onclick="delExpense('${i.id}')">Ø­Ø°Ù</button></td></tr>`).join('')||'<tr><td colspan=5>Ø®Ø§Ù„ÛŒ</td></tr>';
}
function addExpense(){
var d=document.getElementById('expDesc').value,a=+document.getElementById('expAmount').value,c=document.getElementById('expCat').value;
if(d&&a){data.expenses.unshift({id:Date.now(),desc:d,amount:a,category:c,date:new Date().toLocaleDateString('fa')});save();loadExpenses();loadDashboard();alert('âœ…');document.getElementById('expDesc').value='';}}
function delExpense(id){if(confirm('Ø­Ø°ÙØŸ')){data.expenses=data.expenses.filter(i=>i.id!=id);save();loadExpenses();loadDashboard();}}

function loadReports(){
document.getElementById('repContracts').innerHTML=data.contracts.length;
document.getElementById('repInvoices').innerHTML=data.invoices.length;
document.getElementById('repCustomers').innerHTML=data.customers.length;
document.getElementById('repChecks').innerHTML=data.checks.filter(i=>i.status=='Ø¬Ø§Ø±ÛŒ').length;
var inc=data.finances.filter(i=>i.type=='income').reduce((s,i)=>s+i.amount,0);
var exp=data.expenses.reduce((s,i)=>s+i.amount,0);
document.getElementById('repIncome').innerHTML=inc.toLocaleString();
document.getElementById('repExpense').innerHTML=exp.toLocaleString();
}

function loadBackupInfo(){
document.getElementById('backupInfo').innerHTML='Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯: '+data.contracts.length+' | ÙØ§Ú©ØªÙˆØ±: '+data.invoices.length+' | Ù…Ø´ØªØ±ÛŒ: '+data.customers.length+' | Ú©Ø§Ø±Ù…Ù†Ø¯: '+data.workers.length+' | Ú†Ú©: '+data.checks.length+' | Ø­Ø¬Ù…: '+(JSON.stringify(data).length/1024).toFixed(1)+'KB';
}

function printReport(){window.print();}

function downloadBackup(){
var b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');
a.href=u;a.download='kaleshi-v6.json';a.click();URL.revokeObjectURL(u);alert('âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
}

function restoreBackup(e){
var f=e.target.files[0],r=new FileReader();
r.onload=()=>{try{data=JSON.parse(r.result);save();loadAll();alert('âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯')}catch(e){alert('âŒ Ø®Ø·Ø§')}}
r.readAsText(f)
}

function clearAll(){if(confirm('Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')){localStorage.removeItem('kaleshi');location.reload()}}

function updateDate(){document.getElementById('date').innerHTML=new Date().toLocaleDateString('fa')+' '+new Date().toLocaleTimeString('fa')}

function show(id){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.querySelectorAll('.navbtn').forEach(b=>b.classList.remove('active'));
document.getElementById(id).classList.add('active');
event.target.classList.add('active');
if(id=='reports')loadReports();
if(id=='backup')loadBackupInfo();
}

function logout(){location.reload()}

document.onkeypress=e=>{if(e.keyCode==13&&document.querySelector('.login'))login()}
updateDate();
</script>

</body>
</html>
