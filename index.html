<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ… v13.1</title>

    <!-- CDN Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Flatpickr Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fa.js"></script>

    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --light: #f8fafc;
            --dark: #0f172a;
            --gray: #64748b;
            --shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Vazirmatn', 'Tahoma', system-ui, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
            min-height: 100vh; color: var(--dark); line-height: 1.6; 
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .grid { display: grid; gap: 20px; }
        .grid-cols-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .d-none { display: none !important; }
        .w-100 { width: 100%; }
        .text-center { text-align: center; }
        .d-flex { display: flex; }
        .gap-2 { gap: 12px; }
        .gap-3 { gap: 20px; }
        .mt-3 { margin-top: 20px; }
        .mb-3 { margin-bottom: 20px; }
        .row { display: flex; flex-wrap: wrap; margin: 0 -10px; }
        .col-md-4 { flex: 0 0 33.333%; padding: 0 10px; }
        .col-md-6 { flex: 0 0 50%; padding: 0 10px; }

        .btn {
            padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; 
            transition: all 0.3s; font-size: 14px; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-dark { background: var(--dark); color: white; }
        .btn-outline-primary { border: 2px solid var(--secondary); color: var(--secondary); background: transparent; }
        .btn-outline-success { border: 2px solid var(--success); color: var(--success); background: transparent; }
        .btn-outline-info { border: 2px solid var(--info); color: var(--info); background: transparent; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); }
        .form-control {
            width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; 
            font-size: 15px; transition: all 0.3s; background: white;
        }
        .form-control:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .form-control.error { border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239,68,68,0.1) !important; }

        .card { background: white; border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; margin-bottom: 20px; }
        .card-header { 
            background: linear-gradient(135deg, var(--primary), #1e40af); color: white; 
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .card-title { font-size: 18px; font-weight: 700; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { 
            background: linear-gradient(135deg, var(--secondary), #1d4ed8); color: white; 
            padding: 24px; border-radius: 12px; text-align: center; 
        }
        .stat-value { font-size: 28px; font-weight: 800; margin-bottom: 8px; }

        .table-container { overflow-x: auto; margin-top: 20px; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { background: var(--primary); color: white; padding: 15px; text-align: right; font-weight: 600; }
        .table td { padding: 12px 15px; border-bottom: 1px solid #eee; text-align: right; }
        .table tr:hover { background: #f8f9ff; }

        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .login-card { 
            background: white; border-radius: 20px; padding: 40px; width: 100%; max-width: 400px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .login-logo { 
            width: 80px; height: 80px; margin: 0 auto 24px; background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; 
            font-size: 24px; font-weight: 800;
        }

        .main-nav { 
            background: var(--dark); display: flex; overflow-x: auto; padding: 0; 
            scrollbar-width: none; 
        }
        .main-nav::-webkit-scrollbar { display: none; }
        .nav-btn { 
            background: none; border: none; color: rgba(255,255,255,0.9); padding: 16px 20px; 
            cursor: pointer; white-space: nowrap; transition: all 0.3s; border-bottom: 3px solid transparent;
            display: flex; align-items: center; gap: 8px;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .nav-btn.active { background: var(--secondary); color: white; }

        .page { display: none; padding: 20px; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        
        .product-row, .check-row, .customer-row, .expense-row, .invoice-row, .worker-row { 
            display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; align-items: center; 
            padding: 16px; background: #f8fafc; border-radius: 8px; margin-bottom: 12px; 
        }

        .product-categories, .worker-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-btn {
            padding: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .category-btn:hover {
            border-color: var(--secondary);
            background: #f0f9ff;
        }

        .category-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .totals-box { 
            background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 24px; 
            border-radius: 12px; margin: 24px 0;
        }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .total-row:last-child { font-size: 20px; font-weight: 800; border-top: 2px solid rgba(255,255,255,0.3); padding-top: 12px; }

        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--secondary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .notification { 
            position: fixed; top: 20px; right: 20px; background: white; padding: 16px 20px; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 10000; 
            border-right: 4px solid; display: flex; align-items: center; gap: 12px; max-width: 350px;
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; padding: 30px; border-radius: 12px; width: 100%; max-width: 500px; 
            max-height: 90vh; overflow-y: auto;
        }
        .modal-header {
            margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-title { font-size: 20px; font-weight: bold; color: var(--primary); }
        .modal-close {
            background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray);
        }
        .modal-close:hover { color: var(--danger); }

        .badge {
            display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;
        }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-info { background: #d1ecf1; color: #0c5460; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ */
        .validation-error {
            color: #ef4444;
            font-size: 12px;
            margin-top: 4px;
            padding: 4px 8px;
            background-color: #fef2f2;
            border-radius: 4px;
            border-left: 3px solid #ef4444;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ… ÙØ§Ø±Ø³ÛŒ */
        .flatpickr-calendar {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            direction: rtl;
            text-align: right;
        }

        .report-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .report-button {
            padding: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .report-button:hover {
            border-color: var(--secondary);
            background: #f0f9ff;
        }

        .report-button.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        @media (max-width: 768px) { 
            .form-row, .product-row, .check-row, .customer-row, .expense-row, .invoice-row, .worker-row { grid-template-columns: 1fr; } 
            .product-categories, .worker-categories { grid-template-columns: 1fr; }
            .main-nav { flex-direction: column; } 
            .col-md-4, .col-md-6 { flex: 0 0 100%; }
            .report-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <div style="margin-top: 16px; font-weight: 600;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
    </div>

    <!-- Notifications -->
    <div id="notifications"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-logo">CF</div>
            <h2 style="text-align: center; margin-bottom: 24px; color: var(--dark);">Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</h2>
            
            <div class="form-group">
                <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                <input type="text" id="username" class="form-control" value="admin" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                <input type="password" id="password" class="form-control" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            </div>
            
            <button class="btn btn-primary w-100" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</button>
            
            <div style="margin-top: 20px; text-align: center; font-size: 13px; color: var(--gray);">
                Ù¾ÛŒØ´â€ŒÙØ±Ø¶: <strong>admin / 1234</strong>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header style="background: var(--dark); color: white; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 16px;">
                <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-weight: 800; font-size: 18px;">CF</div>
                <div>
                    <h3 style="margin: 0; font-size: 18px;">Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</h3>
                    <div id="currentDate" style="font-size: 13px; opacity: 0.8;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <span id="userName" style="font-weight: 500;"></span>
                <button class="btn btn-danger btn-sm" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav" id="nav">
            <button class="nav-btn active" onclick="showPage('dashboard')">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            <button class="nav-btn" onclick="showPage('contracts')">ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</button>
            <button class="nav-btn" onclick="showPage('customers')">ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
            <button class="nav-btn" onclick="showPage('checks')">ğŸ¦ Ú†Ú©â€ŒÙ‡Ø§</button>
            <button class="nav-btn" onclick="showPage('finance')">ğŸ’° Ù…Ø§Ù„ÛŒ</button>
            <button class="nav-btn" onclick="showPage('workers')">ğŸ‘· Ú©Ø§Ø±Ú©Ù†Ø§Ù†</button>
            <button class="nav-btn" onclick="showPage('invoice')">ğŸ“„ ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ±</button>
            <button class="nav-btn" onclick="showPage('settings')">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            <button class="nav-btn" onclick="showPage('reports')">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</button>
            <button class="nav-btn" onclick="showPage('backup')">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
        </nav>

        <!-- Content -->
        <main class="container">
            <!-- Dashboard -->
            <div id="dashboard" class="page active">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h3>
                        <button class="btn btn-success btn-sm" onclick="updateDashboard()">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                    </div>
                    <div class="stats-grid" id="stats"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“ˆ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="incomeChart" width="400" height="200"></canvas>
                            </div>
                            <div class="col-md-6">
                                <canvas id="expenseChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contracts -->
            <div id="contracts" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
                        <button class="btn btn-warning btn-sm" onclick="resetContractForm()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ù…Ø´ØªØ±ÛŒ</label>
                            <input type="text" id="contractCustomer" class="form-control" list="customerList" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
                        </div>
                        <div class="form-group">
                            <label>ØªÙ„ÙÙ†</label>
                            <input type="tel" id="contractPhone" class="form-control" placeholder="0912...">
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÛŒØ®</label>
                            <input type="text" id="contractDate" class="form-control date-picker" placeholder="Û±Û´Û°Û´/Û°Û±/Û°Û±">
                        </div>
                        <div class="form-group">
                            <label>Ø¢Ø¯Ø±Ø³</label>
                            <textarea id="contractAddress" class="form-control" rows="2"></textarea>
                        </div>
                    </div>

                    <!-- Product Categories -->
                    <h4 style="margin: 20px 0 12px 0;">ğŸ“¦ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª</h4>
                    <div class="product-categories">
                        <button type="button" class="category-btn active" data-category="ÛŒÙˆÙ†ÙˆÙ„ÛŒØª" onclick="selectCategory(this)">
                            <div>ğŸ </div>
                            <div>ÛŒÙˆÙ†ÙˆÙ„ÛŒØª</div>
                        </button>
                        <button type="button" class="category-btn" data-category="ÙˆÙ‚" onclick="selectCategory(this)">
                            <div>ğŸ“¦</div>
                            <div>ÙˆÙ‚</div>
                        </button>
                        <button type="button" class="category-btn" data-category="Ù¾Ø§Ù†Ù„" onclick="selectCategory(this)">
                            <div>ğŸ§±</div>
                            <div>Ù¾Ø§Ù†Ù„</div>
                        </button>
                    </div>

                    <h4 style="margin: 20px 0 12px 0;">ğŸ“‹ Ù…Ø­ØµÙˆÙ„Ø§Øª</h4>
                    <div id="productsContainer"></div>
                    <button type="button" class="btn btn-info btn-sm" onclick="addProductRow()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª (ØªÙˆÙ…Ø§Ù†)</label>
                        <input type="number" id="advancePayment" class="form-control" value="0" oninput="calculateContractTotals()">
                    </div>

                    <h4 style="margin: 20px 0 12px 0;">ğŸ¦ Ú†Ú©â€ŒÙ‡Ø§</h4>
                    <div id="checksContainer"></div>
                    <button type="button" class="btn btn-info btn-sm" onclick="addCheckRow()">â• Ø§ÙØ²ÙˆØ¯Ù† Ú†Ú©</button>

                    <div class="totals-box">
                        <div class="total-row"><span>Ø¬Ù…Ø¹ Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª:</span><strong id="contractTotalDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ:</span><strong id="contractAdvanceDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ù…Ø¬Ù…ÙˆØ¹ Ú†Ú©â€ŒÙ‡Ø§:</span><strong id="contractCheckDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ù…Ø§Ù†Ø¯Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª:</span><strong id="contractBalanceDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button class="btn btn-success" onclick="saveContract()">âœ… Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
                        <button class="btn btn-primary" onclick="printContract()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“‹ Ù„ÛŒØ³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</h3>
                        <div class="form-group" style="margin: 0;">
                            <input type="text" class="form-control" id="searchContracts" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." style="max-width: 300px;">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table" id="contractsTable">
                            <thead>
                                <tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>ØªÙ„ÙÙ†</th><th>Ù…Ø¨Ù„Øº Ú©Ù„</th><th>Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª</th><th>Ú†Ú©</th><th>Ù…Ø§Ù†Ø¯Ù‡</th><th>ØªØ§Ø±ÛŒØ®</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Customers -->
            <div id="customers" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>
                        <button class="btn btn-success btn-sm" onclick="showCustomerModal()">â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</button>
                    </div>
                    <div style="padding: 24px;">
                        <div class="table-container">
                            <table class="table" id="customersTable">
                                <thead>
                                    <tr><th>Ø±Ø¯ÛŒÙ</th><th>Ù†Ø§Ù…</th><th>ØªÙ„ÙÙ†</th><th>Ú©Ø¯ Ù…Ù„ÛŒ</th><th>Ù†ÙˆØ¹</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>Ø®Ø±ÛŒØ¯ Ú©Ù„</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checks -->
            <div id="checks" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ¦ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ú©â€ŒÙ‡Ø§</h3>
                        <button class="btn btn-success btn-sm" onclick="showCheckModal()">â• Ú†Ú© Ø¬Ø¯ÛŒØ¯</button>
                    </div>
                    <div style="padding: 24px;">
                        <div class="table-container">
                            <table class="table" id="checksTable">
                                <thead>
                                    <tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ø¨Ø§Ù†Ú©</th><th>Ø³Ø±Ø±Ø³ÛŒØ¯</th><th>Ù…Ø§Ù†Ø¯Ù‡ Ø±ÙˆØ²</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Finance -->
            <div id="finance" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ’° Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ</h3>
                        <div class="d-flex gap-2">
                            <button class="btn btn-success btn-sm" onclick="showIncomeModal()">â• Ø¯Ø±Ø¢Ù…Ø¯ Ø¬Ø¯ÛŒØ¯</button>
                            <button class="btn btn-danger btn-sm" onclick="showExpenseModal()">â– Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯</button>
                        </div>
                    </div>
                    <div style="padding: 24px;">
                        <div class="stats-grid" id="financeStats"></div>
                        <div class="table-container">
                            <table class="table" id="transactionsTable">
                                <thead>
                                    <tr><th>Ø±Ø¯ÛŒÙ</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ù†ÙˆØ¹</th><th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th><th>Ø´Ø±Ø­</th><th>Ù…Ø¨Ù„Øº</th><th>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workers -->
            <div id="workers" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ‘· Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú©Ù†Ø§Ù†</h3>
                        <button class="btn btn-success btn-sm" onclick="showWorkerModal()">â• Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</button>
                    </div>
                    <div style="padding: 24px;">
                        <div class="stats-grid" id="workerStats"></div>
                        <div class="table-container">
                            <table class="table" id="workersTable">
                                <thead>
                                    <tr><th>Ø±Ø¯ÛŒÙ</th><th>Ù†Ø§Ù…</th><th>Ú©Ø¯ Ù…Ù„ÛŒ</th><th>Ø³Ù…Øª</th><th>Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡</th><th>Ø¨ÛŒÙ…Ù‡</th><th>ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ’° Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯</label>
                                <select id="salaryWorker" class="form-control">
                                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ù…Ø§Ù‡ Ùˆ Ø³Ø§Ù„</label>
                                <input type="text" id="salaryMonth" class="form-control date-picker" placeholder="Û±Û´Û°Û´/Û°Û±">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ø¶Ø§ÙÙ‡ Ú©Ø§Ø±ÛŒ (Ø³Ø§Ø¹Øª)</label>
                                <input type="number" id="overtimeHours" class="form-control" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>Ú©Ø³Ø±ÛŒ Ú©Ø§Ø± (Ø³Ø§Ø¹Øª)</label>
                                <input type="number" id="deficitHours" class="form-control" value="0" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ù¾Ø§Ø¯Ø§Ø´</label>
                                <input type="number" id="bonusAmount" class="form-control" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>Ú©Ø³ÙˆØ±Ø§Øª</label>
                                <input type="number" id="deductionAmount" class="form-control" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <textarea id="salaryDescription" class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="calculateSalary()">ğŸ’° Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ù‚ÙˆÙ‚</button>
                        <div id="salaryResult" class="totals-box" style="display: none; margin-top: 20px;"></div>
                    </div>
                </div>
            </div>

            <!-- Invoice -->
            <div id="invoice" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“„ ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</h3>
                        <button class="btn btn-warning btn-sm" onclick="resetInvoiceForm()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ù…Ø´ØªØ±ÛŒ</label>
                            <input type="text" id="invoiceCustomer" class="form-control" list="customerList" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÛŒØ® ÙØ§Ú©ØªÙˆØ±</label>
                            <input type="text" id="invoiceDate" class="form-control date-picker" placeholder="Û±Û´Û°Û´/Û°Û±/Û°Û±">
                        </div>
                        <div class="form-group">
                            <label>Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±</label>
                            <input type="text" id="invoiceNumber" class="form-control" placeholder="Auto-generated" readonly>
                        </div>
                        <div class="form-group">
                            <label>Ù†ÙˆØ¹ ÙØ§Ú©ØªÙˆØ±</label>
                            <select id="invoiceType" class="form-control">
                                <option value="ÙØ±ÙˆØ´">ÙØ±ÙˆØ´</option>
                                <option value="Ø¨Ø±Ú¯Ø´Øª Ø§Ø² ÙØ±ÙˆØ´">Ø¨Ø±Ú¯Ø´Øª Ø§Ø² ÙØ±ÙˆØ´</option>
                                <option value="Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ±">Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ±</option>
                            </select>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 12px 0;">ğŸ§® Ø§Ù‚Ù„Ø§Ù… ÙØ§Ú©ØªÙˆØ±</h4>
                    <div id="invoiceItemsContainer"></div>
                    <button type="button" class="btn btn-info btn-sm" onclick="addInvoiceItem()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…ÙˆØ±Ø¯</button>

                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>ØªØ®ÙÛŒÙ (ØªÙˆÙ…Ø§Ù†)</label>
                            <input type="number" id="invoiceDiscount" class="form-control" value="0" min="0" oninput="calculateInvoiceTotals()">
                        </div>
                        <div class="form-group">
                            <label>Ù…Ø§Ù„ÛŒØ§Øª (%)</label>
                            <input type="number" id="invoiceTax" class="form-control" value="9" min="0" max="100" oninput="calculateInvoiceTotals()">
                        </div>
                        <div class="form-group">
                            <label>Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„</label>
                            <input type="number" id="invoiceShipping" class="form-control" value="0" min="0" oninput="calculateInvoiceTotals()">
                        </div>
                    </div>

                    <div class="totals-box">
                        <div class="total-row"><span>Ø¬Ù…Ø¹ Ø§Ù‚Ù„Ø§Ù…:</span><strong id="invoiceSubtotalDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>ØªØ®ÙÛŒÙ:</span><strong id="invoiceDiscountDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ù…Ø§Ù„ÛŒØ§Øª:</span><strong id="invoiceTaxDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„:</span><strong id="invoiceShippingDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                        <div class="total-row"><span>Ø¬Ù…Ø¹ Ú©Ù„:</span><strong id="invoiceTotalDisplay">Û° ØªÙˆÙ…Ø§Ù†</strong></div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button class="btn btn-success" onclick="saveInvoice()">âœ… Ø«Ø¨Øª ÙØ§Ú©ØªÙˆØ±</button>
                        <button class="btn btn-primary" onclick="printInvoice()">ğŸ–¨ï¸ Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ±</button>
                        <button class="btn btn-info" onclick="downloadInvoicePDF()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“‹ Ù„ÛŒØ³Øª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</h3>
                        <div class="form-group" style="margin: 0;">
                            <input type="text" class="form-control" id="searchInvoices" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." style="max-width: 300px;">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table" id="invoicesTable">
                            <thead>
                                <tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ù†ÙˆØ¹</th><th>Ù…Ø¨Ù„Øº Ú©Ù„</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settings" class="page">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</h3>
                            </div>
                            <div style="padding: 24px;">
                                <div class="form-group">
                                    <label>Ù†Ø§Ù… Ø´Ø±Ú©Øª</label>
                                    <input type="text" id="companyName" class="form-control" value="Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒ ÙÙˆÙ…">
                                </div>
                                <div class="form-group">
                                    <label>ØªÙ„ÙÙ† Ø´Ø±Ú©Øª</label>
                                    <input type="tel" id="companyPhone" class="form-control" value="09149431013">
                                </div>
                                <div class="form-group">
                                    <label>Ø¢Ø¯Ø±Ø³ Ø´Ø±Ú©Øª</label>
                                    <textarea id="companyAddress" class="form-control" rows="3">Ø§Ø±ÙˆÙ…ÛŒÙ‡ - Ø¬Ø§Ø¯Ù‡ Ø³Ù„Ù…Ø§Ø³ØŒ Ù†Ø±Ø³ÛŒØ¯Ù‡ Ø¨Ù‡ Ø±ÙˆØ³ØªØ§ÛŒ Ù‚Ø²Ù„ Ø¹Ø§Ø´Ù‚ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† Ø¢Ø²Ø§Ø¯ÛŒ</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Ù„ÙˆÚ¯Ùˆ Ø´Ø±Ú©Øª</label>
                                    <input type="file" id="companyLogo" class="form-control" accept="image/*">
                                </div>
                                <button class="btn btn-success" onclick="saveCompanySettings()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">ğŸ” ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ</h3>
                            </div>
                            <div style="padding: 24px;">
                                <div class="form-group">
                                    <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø¯ÛŒØ±</label>
                                    <input type="text" id="adminUsername" class="form-control" value="admin">
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯</label>
                                    <input type="password" id="newPassword" class="form-control" placeholder="Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                                </div>
                                <div class="form-group">
                                    <label>ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                                    <input type="password" id="confirmPassword" class="form-control" placeholder="ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯">
                                </div>
                                <button class="btn btn-primary" onclick="changePassword()">ğŸ”‘ ØªØºÛŒÛŒØ± Ø±Ù…Ø²</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ù†Ø±Ø® Ù…Ø§Ù„ÛŒØ§Øª Ø¨Ø± Ø§Ø±Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù‡ (%)</label>
                                    <input type="number" id="taxRate" class="form-control" value="9" min="0" max="100">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ø­Ø¯Ø§Ù‚Ù„ Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡</label>
                                    <input type="number" id="minSalary" class="form-control" value="45000000" min="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ù†Ø±Ø® Ø§Ø¶Ø§ÙÙ‡ Ú©Ø§Ø±ÛŒ (%)</label>
                                    <input type="number" id="overtimeRate" class="form-control" value="40" min="0">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="saveFinancialSettings()">ğŸ’° Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø±ÛŒ</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø³ÛŒØ³ØªÙ…</label>
                                    <input type="color" id="primaryColor" class="form-control" value="#1e3a8a">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ø±Ù†Ú¯ Ø«Ø§Ù†ÙˆÛŒÙ‡</label>
                                    <input type="color" id="secondaryColor" class="form-control" value="#3b82f6">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>ØªÙ… ØªÛŒØ±Ù‡/Ø±ÙˆØ´Ù†</label>
                                    <select id="themeMode" class="form-control">
                                        <option value="light">Ø±ÙˆØ´Ù†</option>
                                        <option value="dark">ØªÛŒØ±Ù‡</option>
                                        <option value="auto">Ø®ÙˆØ¯Ú©Ø§Ø±</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-info" onclick="applyThemeSettings()">ğŸ¨ Ø§Ø¹Ù…Ø§Ù„ ØªÙ…</button>
                    </div>
                </div>
            </div>

            <!-- Reports -->
            <div id="reports" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="report-buttons">
                            <button class="report-button" onclick="generateReport('detailed_financial')">
                                <div>ğŸ“Š</div>
                                <div>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ ØªÙØµÛŒÙ„ÛŒ</div>
                            </button>
                            <button class="report-button" onclick="generateReport('customer_analysis')">
                                <div>ğŸ‘¥</div>
                                <div>ØªØ­Ù„ÛŒÙ„ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                            </button>
                            <button class="report-button" onclick="generateReport('check_analysis')">
                                <div>ğŸ¦</div>
                                <div>ØªØ­Ù„ÛŒÙ„ Ú†Ú©â€ŒÙ‡Ø§</div>
                            </button>
                            <button class="report-button" onclick="generateReport('profit_loss')">
                                <div>ğŸ’°</div>
                                <div>Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù† Ú©Ø§Ù…Ù„</div>
                            </button>
                        </div>
                        
                        <!-- ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ -->
                        <div class="form-row" style="margin-bottom: 20px;">
                            <div class="form-group">
                                <label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</label>
                                <input type="text" id="reportStartDate" class="form-control date-picker" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹">
                            </div>
                            <div class="form-group">
                                <label>ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</label>
                                <input type="text" id="reportEndDate" class="form-control date-picker" placeholder="ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†">
                            </div>
                            <div class="form-group">
                                <label style="opacity: 0;">Ø¹Ù…Ù„ÛŒØ§Øª</label>
                                <button class="btn btn-primary w-100" onclick="applyDateFilter()">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®</button>
                            </div>
                        </div>
                        
                        <div id="reportResults"></div>
                    </div>
                </div>
            </div>

            <!-- Backup -->
            <div id="backup" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ’¾ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="exportToExcel('contracts')">ğŸ“Š Ø§Ú©Ø³Ù„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</button>
                                    <button class="btn btn-primary" onclick="exportToExcel('customers')">ğŸ‘¥ Ø§Ú©Ø³Ù„ Ù…Ø´ØªØ±ÛŒØ§Ù†</button>
                                    <button class="btn btn-info" onclick="exportToExcel('checks')">ğŸ¦ Ø§Ú©Ø³Ù„ Ú†Ú©â€ŒÙ‡Ø§</button>
                                    <button class="btn btn-warning" onclick="exportToExcel('transactions')">ğŸ’° Ø§Ú©Ø³Ù„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
                                    <button class="btn btn-dark" onclick="exportToExcel('workers')">ğŸ‘· Ø§Ú©Ø³Ù„ Ú©Ø§Ø±Ú©Ù†Ø§Ù†</button>
                                    <button class="btn btn-secondary" onclick="exportToExcel('invoices')">ğŸ“„ Ø§Ú©Ø³Ù„ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</button>
                                    <button class="btn btn-outline-primary" onclick="backupToJSON(true)">ğŸ”’ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>ğŸ“¥ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</h5>
                                <input type="file" id="backupFile" class="form-control mb-3" accept=".json,.kaleshi">
                                <button class="btn btn-danger w-100" onclick="restoreFromBackup()">ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
                                <hr>
                                <h6>Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø±</h6>
                                <div class="form-group">
                                    <label>ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</label>
                                    <select id="autoBackupInterval" class="form-control">
                                        <option value="0">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                                        <option value="1">Ù‡Ø± Ø±ÙˆØ²</option>
                                        <option value="7">Ù‡Ø± Ù‡ÙØªÙ‡</option>
                                        <option value="30">Ù‡Ø± Ù…Ø§Ù‡</option>
                                    </select>
                                </div>
                                <button class="btn btn-info w-100" onclick="setupAutoBackup()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø±</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Datalist for Customers -->
    <datalist id="customerList"></datalist>

    <!-- Modals -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘¥ Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close" onclick="closeModal('customerModal')">Ã—</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ù†Ø§Ù… Ú©Ø§Ù…Ù„ *</label>
                    <input type="text" id="modalCustomerName" class="form-control" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
                </div>
                <div class="form-group">
                    <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ *</label>
                    <input type="tel" id="modalCustomerPhone" class="form-control" placeholder="09123456789">
                </div>
                <div class="form-group">
                    <label>Ú©Ø¯ Ù…Ù„ÛŒ</label>
                    <input type="text" id="modalCustomerNationalCode" class="form-control" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ">
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ</label>
                    <select id="modalCustomerType" class="form-control">
                        <option value="Ø¹Ø§Ø¯ÛŒ">Ø¹Ø§Ø¯ÛŒ</option>
                        <option value="ÙˆÛŒÚ˜Ù‡">ÙˆÛŒÚ˜Ù‡</option>
                        <option value="Ø­Ù‚ÙˆÙ‚ÛŒ">Ø­Ù‚ÙˆÙ‚ÛŒ</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ø¢Ø¯Ø±Ø³</label>
                <textarea id="modalCustomerAddress" class="form-control" rows="3"></textarea>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-success" onclick="saveCustomerModal()">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
                <button class="btn btn-warning" onclick="closeModal('customerModal')">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <div class="modal" id="checkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ¦ Ø«Ø¨Øª Ú†Ú© Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close" onclick="closeModal('checkModal')">Ã—</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø´Ù…Ø§Ø±Ù‡ Ú†Ú© *</label>
                    <input type="text" id="modalCheckNumber" class="form-control" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©">
                </div>
                <div class="form-group">
                    <label>Ù…Ø´ØªØ±ÛŒ *</label>
                    <input type="text" id="modalCheckCustomer" class="form-control" list="customerList" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†) *</label>
                    <input type="number" id="modalCheckAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº Ú†Ú©">
                </div>
                <div class="form-group">
                    <label>Ø¨Ø§Ù†Ú©</label>
                    <select id="modalCheckBank" class="form-control">
                        <option value="Ù…Ù„Øª">Ù…Ù„Øª</option>
                        <option value="ØµØ§Ø¯Ø±Ø§Øª">ØµØ§Ø¯Ø±Ø§Øª</option>
                        <option value="Ù…Ù„ÛŒ">Ù…Ù„ÛŒ</option>
                        <option value="ØªØ¬Ø§Ø±Øª">ØªØ¬Ø§Ø±Øª</option>
                        <option value="Ø±ÙØ§Ù‡">Ø±ÙØ§Ù‡</option>
                        <option value="Ø³Ø§ÛŒØ±">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ® Ø³Ø±Ø±Ø³ÛŒØ¯ *</label>
                <input type="text" id="modalCheckDueDate" class="form-control check-due-date" placeholder="Û±Û´Û°Û´/Û°Û±/Û°Û±">
            </div>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-success" onclick="saveCheckModal()">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
                <button class="btn btn-warning" onclick="closeModal('checkModal')">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <div class="modal" id="incomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">â• Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close" onclick="closeModal('incomeModal')">Ã—</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® *</label>
                    <input type="text" id="modalIncomeDate" class="form-control date-picker" placeholder="Û±Û´Û°Û´/Û°Û±/Û°Û±">
                </div>
                <div class="form-group">
                    <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ *</label>
                    <select id="modalIncomeCategory" class="form-control">
                        <option value="ÙØ±ÙˆØ´">ÙØ±ÙˆØ´</option>
                        <option value="Ø¯Ø±ÛŒØ§ÙØª Ú†Ú©">Ø¯Ø±ÛŒØ§ÙØª Ú†Ú©</option>
                        <option value="Ø³Ø§ÛŒØ±">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†) *</label>
                    <input type="number" id="modalIncomeAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº">
                </div>
                <div class="form-group">
                    <label>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                    <select id="modalIncomePaymentMethod" class="form-control">
                        <option value="Ù†Ù‚Ø¯ÛŒ">Ù†Ù‚Ø¯ÛŒ</option>
                        <option value="Ú©Ø§Ø±Øª">Ú©Ø§Ø±Øª</option>
                        <option value="Ú†Ú©">Ú†Ú©</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ø´Ø±Ø­ *</label>
                <textarea id="modalIncomeDescription" class="form-control" rows="3" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ø±Ø¢Ù…Ø¯"></textarea>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-success" onclick="saveIncomeModal()">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
                <button class="btn btn-warning" onclick="closeModal('incomeModal')">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">â– Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close" onclick="closeModal('expenseModal')">Ã—</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® *</label>
                    <input type="text" id="modalExpenseDate" class="form-control date-picker" placeholder="Û±Û´Û°Û´/Û°Û±/Û°Û±">
                </div>
                <div class="form-group">
                    <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ *</label>
                    <select id="modalExpenseCategory" class="form-control">
                        <option value="Ø­Ù‚ÙˆÙ‚">Ø­Ù‚ÙˆÙ‚</option>
                        <option value="Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡">Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</option>
                        <option value="Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„">Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„</option>
                        <option value="ØªØ¹Ù…ÛŒØ±Ø§Øª">ØªØ¹Ù…ÛŒØ±Ø§Øª</option>
                        <option value="Ø§Ø¯Ø§Ø±ÛŒ">Ø§Ø¯Ø§Ø±ÛŒ</option>
                        <option value="Ø³Ø§ÛŒØ±">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†) *</label>
                    <input type="number" id="modalExpenseAmount" class="form-control" placeholder="Ù…Ø¨Ù„Øº">
                </div>
                <div class="form-group">
                    <label>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                    <select id="modalExpensePaymentMethod" class="form-control">
                        <option value="Ù†Ù‚Ø¯ÛŒ">Ù†Ù‚Ø¯ÛŒ</option>
                        <option value="Ú©Ø§Ø±Øª">Ú©Ø§Ø±Øª</option>
                        <option value="Ú†Ú©">Ú†Ú©</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ø´Ø±Ø­ *</label>
                <textarea id="modalExpenseDescription" class="form-control" rows="3" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ù‡Ø²ÛŒÙ†Ù‡"></textarea>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-success" onclick="saveExpenseModal()">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
                <button class="btn btn-warning" onclick="closeModal('expenseModal')">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <div class="modal" id="workerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘· Ø«Ø¨Øª Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close" onclick="closeModal('workerModal')">Ã—</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ù†Ø§Ù… Ú©Ø§Ù…Ù„ *</label>
                    <input type="text" id="modalWorkerName" class="form-control" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
                </div>
                <div class="form-group">
                    <label>Ú©Ø¯ Ù…Ù„ÛŒ *</label>
                    <input type="text" id="modalWorkerNationalCode" class="form-control" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ">
                </div>
                <div class="form-group">
                    <label>ØªÙ„ÙÙ†</label>
                    <input type="tel" id="modalWorkerPhone" class="form-control" placeholder="09123456789">
                </div>
                <div class="form-group">
                    <label>Ø³Ù…Øª *</label>
                    <select id="modalWorkerPosition" class="form-control">
                        <option value="Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡">Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡</option>
                        <option value="Ú©Ø§Ø±Ú¯Ø± Ù…Ø§Ù‡Ø±">Ú©Ø§Ø±Ú¯Ø± Ù…Ø§Ù‡Ø±</option>
                        <option value="Ø³Ø±Ú©Ø§Ø±Ú¯Ø±">Ø³Ø±Ú©Ø§Ø±Ú¯Ø±</option>
                        <option value="Ù…Ø¯ÛŒØ± ØªÙˆÙ„ÛŒØ¯">Ù…Ø¯ÛŒØ± ØªÙˆÙ„ÛŒØ¯</option>
                        <option value="Ù…Ø³Ø¦ÙˆÙ„ ÙØ±ÙˆØ´">Ù…Ø³Ø¦ÙˆÙ„ ÙØ±ÙˆØ´</option>
                        <option value="Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±">Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±</option>
                        <option value="Ù…Ø¯ÛŒØ± Ø¹Ø§Ù…Ù„">Ù…Ø¯ÛŒØ± Ø¹Ø§Ù…Ù„</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡ (ØªÙˆÙ…Ø§Ù†)</label>
                    <input type="number" id="modalWorkerBaseSalary" class="form-control" placeholder="Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡ Ù…Ø§Ù‡Ø§Ù†Ù‡" min="0">
                </div>
                <div class="form-group">
                    <label>Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ Ø¯Ø± Ù‡ÙØªÙ‡</label>
                    <input type="number" id="modalWorkerWeeklyHours" class="form-control" value="44" min="1" max="168">
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯</label>
                    <input type="text" id="modalWorkerStartDate" class="form-control date-picker" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ú©Ø§Ø±">
                </div>
                <div class="form-group">
                    <label>ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="modalWorkerStatus" class="form-control">
                        <option value="ÙØ¹Ø§Ù„">ÙØ¹Ø§Ù„</option>
                        <option value="ØºÛŒØ±ÙØ¹Ø§Ù„">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                        <option value="Ù…Ø±Ø®ØµÛŒ">Ø¯Ø± Ù…Ø±Ø®ØµÛŒ</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ø¢Ø¯Ø±Ø³</label>
                <textarea id="modalWorkerAddress" class="form-control" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                <textarea id="modalWorkerNotes" class="form-control" rows="2"></textarea>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-success" onclick="saveWorkerModal()">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
                <button class="btn btn-warning" onclick="closeModal('workerModal')">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL DATA =====
        let appData = JSON.parse(localStorage.getItem('kaleshiFoamData')) || {
            contracts: [],
            customers: [],
            transactions: [],
            checks: [],
            workers: [],
            invoices: [],
            salaryRecords: [],
            settings: {
                companyName: 'Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÙˆÙ†ÙˆÙ„ÛŒØª Ú©Ù„Ø´ÛŒ ÙÙˆÙ…',
                companyPhone: '09149431013',
                companyAddress: 'Ø§Ø±ÙˆÙ…ÛŒÙ‡ - Ø¬Ø§Ø¯Ù‡ Ø³Ù„Ù…Ø§Ø³ØŒ Ù†Ø±Ø³ÛŒØ¯Ù‡ Ø¨Ù‡ Ø±ÙˆØ³ØªØ§ÛŒ Ù‚Ø²Ù„ Ø¹Ø§Ø´Ù‚ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† Ø¢Ø²Ø§Ø¯ÛŒ',
                taxRate: 9,
                minSalary: 45000000,
                overtimeRate: 40,
                primaryColor: '#1e3a8a',
                secondaryColor: '#3b82f6',
                themeMode: 'light',
                autoBackupInterval: 7
            },
            auth: {
                username: 'admin',
                password: CryptoJS.SHA256('1234').toString()
            },
            currentUser: null,
            version: '13.1'
        };

        let editingId = null;
        let productRowCount = 0;
        let checkRowCount = 0;
        let invoiceItemCount = 0;
        let currentProductCategory = 'ÛŒÙˆÙ†ÙˆÙ„ÛŒØª';
        let charts = {};

        // ===== UTILITY FUNCTIONS =====
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.borderRightColor = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#f59e0b';
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            notification.innerHTML = `
                <span>${icons[type] || 'âœ…'}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="margin-right: auto; background: none; border: none; font-size: 18px; cursor: pointer">Ã—</button>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        function showLoading(message = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...') {
            const overlay = document.getElementById('loading');
            overlay.querySelector('div').textContent = message;
            overlay.style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // ===== LOGIN SYSTEM =====
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const hashedPassword = CryptoJS.SHA256(password).toString();
            
            if (username === appData.auth.username && hashedPassword === appData.auth.password) {
                appData.currentUser = { username, name: 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…' };
                saveData();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userName').textContent = appData.currentUser.name;
                
                initializeSystem();
                showNotification('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²', 'success');
            } else {
                showNotification('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
            }
        }

        function logout() {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.currentUser = null;
                saveData();
                location.reload();
            }
        }

        // ===== NAVIGATION =====
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            event.target.closest('button').classList.add('active');
            
            loadPageData(pageId);
        }

        function loadPageData(pageId) {
            switch (pageId) {
                case 'dashboard':
                    updateDashboard();
                    updateCharts();
                    break;
                case 'contracts':
                    loadContractsList();
                    loadCustomerDatalist();
                    break;
                case 'customers':
                    loadCustomersList();
                    break;
                case 'checks':
                    loadChecksList();
                    break;
                case 'finance':
                    loadFinancePage();
                    break;
                case 'workers':
                    loadWorkersPage();
                    break;
                case 'invoice':
                    loadInvoicePage();
                    break;
                case 'settings':
                    loadSettingsPage();
                    break;
                case 'reports':
                    loadReportsPage();
                    break;
                case 'backup':
                    loadBackupPage();
                    break;
            }
        }

        // ===== PERSIAN CALENDAR =====
        function initializePersianCalendar() {
            // ØªÙ‚ÙˆÛŒÙ… Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ø³Ø±Ø±Ø³ÛŒØ¯ Ú†Ú©â€ŒÙ‡Ø§
            flatpickr('.check-due-date', {
                locale: 'fa',
                dateFormat: 'Y/m/d',
                altInput: true,
                altFormat: 'Y/m/d',
                defaultDate: 'today',
                minDate: 'today',
                locale: {
                    firstDayOfWeek: 6,
                    weekdays: {
                        shorthand: ['ÛŒ', 'Ø¯', 'Ø³', 'Ú†', 'Ù¾', 'Ø¬', 'Ø´'],
                        longhand: ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡']
                    },
                    months: {
                        shorthand: ['ÙØ±', 'Ø§Ø±', 'Ø®Ø±', 'ØªØ¨', 'Ù…Ø±Ø¯', 'Ø´Ù‡', 'Ù…Ù‡', 'Ø¢Ø¨', 'Ø¢Ø°', 'Ø¯ÛŒ', 'Ø¨Ù‡', 'Ø§Ø³'],
                        longhand: ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯']
                    }
                },
                onChange: function(selectedDates, dateStr) {
                    calculateContractTotals();
                }
            });

            // ØªÙ‚ÙˆÛŒÙ… Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
            flatpickr('.date-picker:not(.check-due-date)', {
                locale: 'fa',
                dateFormat: 'Y/m/d',
                altInput: true,
                altFormat: 'Y/m/d',
                defaultDate: 'today',
                locale: {
                    firstDayOfWeek: 6,
                    weekdays: {
                        shorthand: ['ÛŒ', 'Ø¯', 'Ø³', 'Ú†', 'Ù¾', 'Ø¬', 'Ø´'],
                        longhand: ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡']
                    },
                    months: {
                        shorthand: ['ÙØ±', 'Ø§Ø±', 'Ø®Ø±', 'ØªØ¨', 'Ù…Ø±Ø¯', 'Ø´Ù‡', 'Ù…Ù‡', 'Ø¢Ø¨', 'Ø¢Ø°', 'Ø¯ÛŒ', 'Ø¨Ù‡', 'Ø§Ø³'],
                        longhand: ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯']
                    }
                }
            });
        }

        // ===== VALIDATION FUNCTIONS =====
        function validateMobilePhone(phone) {
            const regex = /^09[0-9]{9}$/;
            return regex.test(phone);
        }

        function validateNationalCode(code) {
            if (!code || code.length !== 10) return false;
            
            if (!/^\d{10}$/.test(code)) return false;
            
            const uniqueDigits = new Set(code.split(''));
            if (uniqueDigits.size === 1) return false;
            
            const digits = code.split('').map(Number);
            const lastDigit = digits[9];
            let sum = 0;
            
            for (let i = 0; i < 9; i++) {
                sum += digits[i] * (10 - i);
            }
            
            const remainder = sum % 11;
            const controlDigit = remainder < 2 ? remainder : 11 - remainder;
            
            return controlDigit === lastDigit;
        }

        function showValidationError(input, message) {
            input.classList.add('error');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error';
            errorDiv.textContent = message;
            
            const parent = input.parentElement;
            const existingError = parent.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
            parent.appendChild(errorDiv);
            
            setTimeout(() => {
                input.classList.remove('error');
                errorDiv.remove();
            }, 3000);
        }

        function clearValidationError(input) {
            input.classList.remove('error');
            const errorDiv = input.parentElement.querySelector('.validation-error');
            if (errorDiv) {
                errorDiv.remove();
            }
        }

        // ===== PRODUCT CATEGORIES =====
        function selectCategory(btn) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentProductCategory = btn.dataset.category;
        }

        // ===== CONTRACTS PAGE =====
        function addProductRow() {
            productRowCount++;
            const container = document.getElementById('productsContainer');
            const row = document.createElement('div');
            row.className = 'product-row';
            row.setAttribute('data-row', productRowCount);
            
            row.innerHTML = `
                <select class="form-control product-category" onchange="calculateContractTotals()">
                    <option value="ÛŒÙˆÙ†ÙˆÙ„ÛŒØª" ${currentProductCategory === 'ÛŒÙˆÙ†ÙˆÙ„ÛŒØª' ? 'selected' : ''}>ÛŒÙˆÙ†ÙˆÙ„ÛŒØª</option>
                    <option value="ÙˆÙ‚" ${currentProductCategory === 'ÙˆÙ‚' ? 'selected' : ''}>ÙˆÙ‚</option>
                    <option value="Ù¾Ø§Ù†Ù„" ${currentProductCategory === 'Ù¾Ø§Ù†Ù„' ? 'selected' : ''}>Ù¾Ø§Ù†Ù„</option>
                </select>
                <input type="number" class="form-control product-qty" placeholder="Ù…Ù‚Ø¯Ø§Ø±" min="0" oninput="calculateContractTotals()">
                <input type="number" class="form-control product-price" placeholder="Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯" min="0" oninput="calculateContractTotals()">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeProductRow(${productRowCount})">âœ•</button>
            `;
            
            container.appendChild(row);
        }

        function removeProductRow(rowNumber) {
            document.querySelector(`[data-row="${rowNumber}"]`).remove();
            calculateContractTotals();
        }

        function addCheckRow() {
            checkRowCount++;
            const container = document.getElementById('checksContainer');
            const row = document.createElement('div');
            row.className = 'check-row';
            row.setAttribute('data-check', checkRowCount);
            
            row.innerHTML = `
                <input type="text" class="form-control check-number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©">
                <input type="number" class="form-control check-amount" placeholder="Ù…Ø¨Ù„Øº" min="0" oninput="calculateContractTotals()">
                <input type="text" class="form-control check-due-date date-picker" placeholder="ØªØ§Ø±ÛŒØ® Ø³Ø±Ø±Ø³ÛŒØ¯">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeCheckRow(${checkRowCount})">âœ•</button>
            `;
            
            container.appendChild(row);
            initializePersianCalendar();
        }

        function removeCheckRow(checkNumber) {
            document.querySelector(`[data-check="${checkNumber}"]`).remove();
            calculateContractTotals();
        }

        function calculateContractTotals() {
            let totalProducts = 0;
            
            document.querySelectorAll('.product-row').forEach(row => {
                const qty = parseFloat(row.querySelector('.product-qty').value) || 0;
                const price = parseFloat(row.querySelector('.product-price').value) || 0;
                totalProducts += qty * price;
            });
            
            let totalChecks = 0;
            document.querySelectorAll('.check-row').forEach(row => {
                totalChecks += parseFloat(row.querySelector('.check-amount').value) || 0;
            });
            
            const advance = parseFloat(document.getElementById('advancePayment').value) || 0;
            const balance = totalProducts - advance - totalChecks;
            
            document.getElementById('contractTotalDisplay').textContent = `${totalProducts.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('contractAdvanceDisplay').textContent = `${advance.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('contractCheckDisplay').textContent = `${totalChecks.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            
            const balanceColor = balance > 0 ? 'var(--success)' : balance < 0 ? 'var(--danger)' : 'var(--warning)';
            document.getElementById('contractBalanceDisplay').innerHTML = `<span style="color: ${balanceColor}">${balance.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>`;
        }

        function saveContract() {
            const customer = document.getElementById('contractCustomer').value.trim();
            const phone = document.getElementById('contractPhone').value.trim();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!customer) {
                showValidationError(document.getElementById('contractCustomer'), 'Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!phone) {
                showValidationError(document.getElementById('contractPhone'), 'ØªÙ„ÙÙ† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!validateMobilePhone(phone)) {
                showValidationError(document.getElementById('contractPhone'), 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                return;
            }
            
            const products = [];
            document.querySelectorAll('.product-row').forEach(row => {
                const category = row.querySelector('.product-category').value;
                const qty = parseFloat(row.querySelector('.product-qty').value) || 0;
                const price = parseFloat(row.querySelector('.product-price').value) || 0;
                
                if (qty > 0 && price > 0) {
                    products.push({ category, qty, price, total: qty * price });
                }
            });
            
            if (products.length === 0) {
                showNotification('Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯', 'error');
                return;
            }
            
            const checks = [];
            document.querySelectorAll('.check-row').forEach(row => {
                const number = row.querySelector('.check-number').value;
                const amount = parseFloat(row.querySelector('.check-amount').value) || 0;
                const dueDate = row.querySelector('.check-due-date').value;
                
                if (number && amount > 0 && dueDate) {
                    checks.push({ number, amount, dueDate });
                }
            });
            
            const totalProducts = products.reduce((sum, p) => sum + p.total, 0);
            const totalChecks = checks.reduce((sum, c) => sum + c.amount, 0);
            const advance = parseFloat(document.getElementById('advancePayment').value) || 0;
            const balance = totalProducts - advance - totalChecks;
            
            const year = new Date().toLocaleDateString('fa-IR').split('/')[0];
            const seq = (appData.contracts.length + 1).toString().padStart(4, '0');
            const contractNumber = `${year}-${seq}`;
            
            const contract = {
                id: Date.now(),
                contractNumber,
                customer,
                phone,
                address: document.getElementById('contractAddress').value,
                date: document.getElementById('contractDate').value || new Date().toLocaleDateString('fa-IR'),
                products,
                checks,
                totalAmount: totalProducts,
                advance,
                checkAmount: totalChecks,
                balance,
                status: 'ÙØ¹Ø§Ù„'
            };
            
            if (editingId) {
                const index = appData.contracts.findIndex(c => c.id === editingId);
                if (index !== -1) {
                    appData.contracts[index] = contract;
                }
            } else {
                appData.contracts.push(contract);
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ Ú†Ú©â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø®Ø´ Ú†Ú©â€ŒÙ‡Ø§
            checks.forEach(check => {
                appData.checks.push({
                    id: Date.now() + Math.random(),
                    contractId: contract.id,
                    contractNumber: contract.contractNumber,
                    customer,
                    number: check.number,
                    amount: check.amount,
                    dueDate: check.dueDate,
                    bank: 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡',
                    status: 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†',
                    createdDate: contract.date
                });
            });
            
            saveData();
            showNotification(editingId ? 'Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯' : 'Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
            resetContractForm();
            loadContractsList();
            updateDashboard();
        }

        function resetContractForm() {
            document.getElementById('contractCustomer').value = '';
            document.getElementById('contractPhone').value = '';
            document.getElementById('contractAddress').value = '';
            document.getElementById('advancePayment').value = '0';
            
            productRowCount = 0;
            checkRowCount = 0;
            
            document.getElementById('productsContainer').innerHTML = '';
            document.getElementById('checksContainer').innerHTML = '';
            
            addProductRow();
            addCheckRow();
            calculateContractTotals();
            
            editingId = null;
        }

        function printContract() {
            showNotification('Ú†Ø§Ù¾ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
        }

        // ===== CUSTOMERS PAGE =====
        function loadCustomersList() {
            const tbody = document.querySelector('#customersTable tbody');
            tbody.innerHTML = '';
            
            if (appData.customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">Ù‡ÛŒÚ† Ù…Ø´ØªØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                return;
            }
            
            appData.customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                const typeBadge = customer.type === 'ÙˆÛŒÚ˜Ù‡' ? 'badge-success' : customer.type === 'Ø­Ù‚ÙˆÙ‚ÛŒ' ? 'badge-info' : 'badge-secondary';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.nationalCode || '-'}</td>
                    <td><span class="badge ${typeBadge}">${customer.type}</span></td>
                    <td>${customer.registrationDate}</td>
                    <td>${(customer.totalSpent || 0).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewCustomer('${customer.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-warning btn-sm" onclick="editCustomer('${customer.id}')">âœï¸</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCustomer('${customer.id}')">ğŸ—‘ï¸</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showCustomerModal() {
            showModal('customerModal');
            document.getElementById('modalCustomerName').value = '';
            document.getElementById('modalCustomerPhone').value = '';
            document.getElementById('modalCustomerNationalCode').value = '';
            document.getElementById('modalCustomerType').value = 'Ø¹Ø§Ø¯ÛŒ';
            document.getElementById('modalCustomerAddress').value = '';
        }

        function saveCustomerModal() {
            const name = document.getElementById('modalCustomerName').value.trim();
            const phone = document.getElementById('modalCustomerPhone').value.trim();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!name) {
                showValidationError(document.getElementById('modalCustomerName'), 'Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!phone) {
                showValidationError(document.getElementById('modalCustomerPhone'), 'ØªÙ„ÙÙ† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!validateMobilePhone(phone)) {
                showValidationError(document.getElementById('modalCustomerPhone'), 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                return;
            }
            
            const nationalCode = document.getElementById('modalCustomerNationalCode').value;
            if (nationalCode && !validateNationalCode(nationalCode)) {
                showValidationError(document.getElementById('modalCustomerNationalCode'), 'Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                return;
            }
            
            const customer = {
                id: Date.now(),
                name,
                phone,
                nationalCode: nationalCode,
                type: document.getElementById('modalCustomerType').value,
                address: document.getElementById('modalCustomerAddress').value,
                registrationDate: new Date().toLocaleDateString('fa-IR'),
                totalSpent: 0
            };
            
            appData.customers.push(customer);
            saveData();
            loadCustomersList();
            loadCustomerDatalist();
            closeModal('customerModal');
            showNotification('Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯', 'success');
        }

        function viewCustomer(id) {
            const customer = appData.customers.find(c => c.id === id);
            if (customer) {
                alert(`Ù…Ø´ØªØ±ÛŒ: ${customer.name}\nØªÙ„ÙÙ†: ${customer.phone}\nÚ©Ø¯ Ù…Ù„ÛŒ: ${customer.nationalCode || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}\nÙ†ÙˆØ¹: ${customer.type}\nØ¢Ø¯Ø±Ø³: ${customer.address || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}\nØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: ${customer.registrationDate}\nØ®Ø±ÛŒØ¯ Ú©Ù„: ${(customer.totalSpent || 0).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`);
            }
        }

        function editCustomer(id) {
            const customer = appData.customers.find(c => c.id === id);
            if (customer) {
                const newName = prompt('Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯:', customer.name);
                const newPhone = prompt('ØªÙ„ÙÙ† Ø¬Ø¯ÛŒØ¯:', customer.phone);
                
                if (newName && newPhone) {
                    customer.name = newName;
                    customer.phone = newPhone;
                    saveData();
                    loadCustomersList();
                    showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
                }
            }
        }

        function deleteCustomer(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø´ØªØ±ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.customers = appData.customers.filter(c => c.id !== id);
                saveData();
                loadCustomersList();
                loadCustomerDatalist();
                showNotification('Ù…Ø´ØªØ±ÛŒ Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        // ===== CHECKS PAGE =====
        function loadChecksList() {
            const tbody = document.querySelector('#checksTable tbody');
            tbody.innerHTML = '';
            
            if (appData.checks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center py-4">Ù‡ÛŒÚ† Ú†Ú©ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }
            
            const today = new Date();
            
            appData.checks.forEach((check, index) => {
                const dueDate = new Date(check.dueDate);
                const diffTime = dueDate.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const statusBadge = check.status === 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†' ? 'badge-warning' : 
                                  check.status === 'ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡' ? 'badge-success' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${check.number}</td>
                    <td>${check.customer}</td>
                    <td>${check.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td>${check.bank}</td>
                    <td>${check.dueDate}</td>
                    <td>
                        <span class="badge ${diffDays <= 7 && diffDays >= 0 ? 'badge-danger' : diffDays < 0 ? 'badge-danger' : 'badge-info'}">
                            ${diffDays} Ø±ÙˆØ²
                        </span>
                    </td>
                    <td><span class="badge ${statusBadge}">${check.status}</span></td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="updateCheckStatus('${check.id}', 'ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡')">ÙˆØµÙˆÙ„</button>
                        <button class="btn btn-danger btn-sm" onclick="updateCheckStatus('${check.id}', 'Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡')">Ø¨Ø±Ú¯Ø´Øª</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCheck('${check.id}')">Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showCheckModal() {
            showModal('checkModal');
            document.getElementById('modalCheckNumber').value = '';
            document.getElementById('modalCheckCustomer').value = '';
            document.getElementById('modalCheckAmount').value = '';
            document.getElementById('modalCheckBank').value = 'Ù…Ù„Øª';
            document.getElementById('modalCheckDueDate').value = '';
        }

        function saveCheckModal() {
            const number = document.getElementById('modalCheckNumber').value.trim();
            const customer = document.getElementById('modalCheckCustomer').value.trim();
            const amount = parseFloat(document.getElementById('modalCheckAmount').value) || 0;
            const bank = document.getElementById('modalCheckBank').value;
            const dueDate = document.getElementById('modalCheckDueDate').value;
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!number) {
                showValidationError(document.getElementById('modalCheckNumber'), 'Ø´Ù…Ø§Ø±Ù‡ Ú†Ú© Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!customer) {
                showValidationError(document.getElementById('modalCheckCustomer'), 'Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (amount <= 0) {
                showValidationError(document.getElementById('modalCheckAmount'), 'Ù…Ø¨Ù„Øº Ú†Ú© Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯');
                return;
            }
            
            if (!dueDate) {
                showValidationError(document.getElementById('modalCheckDueDate'), 'ØªØ§Ø±ÛŒØ® Ø³Ø±Ø±Ø³ÛŒØ¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©
            const existingCheck = appData.checks.find(c => c.number === number);
            if (existingCheck) {
                showValidationError(document.getElementById('modalCheckNumber'), 'Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ Ú†Ú© Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
                return;
            }
            
            const check = {
                id: Date.now(),
                number,
                customer,
                amount,
                bank,
                dueDate,
                status: 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†',
                createdDate: new Date().toLocaleDateString('fa-IR'),
                createdBy: appData.currentUser?.name || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…'
            };
            
            appData.checks.push(check);
            saveData();
            loadChecksList();
            closeModal('checkModal');
            showNotification('Ú†Ú© Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
        }

        function updateCheckStatus(id, status) {
            const check = appData.checks.find(c => c.id === id);
            if (check) {
                check.status = status;
                saveData();
                loadChecksList();
                showNotification(`ÙˆØ¶Ø¹ÛŒØª Ú†Ú© Ø¨Ù‡ ${status} ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`, 'success');
            }
        }

        function deleteCheck(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú†Ú© Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.checks = appData.checks.filter(c => c.id !== id);
                saveData();
                loadChecksList();
                showNotification('Ú†Ú© Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        // ===== FINANCE PAGE =====
        function loadFinancePage() {
            updateFinancialSummary();
            loadTransactionsList();
        }

        function updateFinancialSummary() {
            const income = appData.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expense = appData.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const profit = income - expense;
            const cashBalance = income - expense;
            
            const statsContainer = document.getElementById('financeStats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${income.toLocaleString('fa-IR')}</div>
                    <div>Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <div class="stat-value">${expense.toLocaleString('fa-IR')}</div>
                    <div>Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                    <div class="stat-value">${profit.toLocaleString('fa-IR')}</div>
                    <div>Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div class="stat-value">${cashBalance.toLocaleString('fa-IR')}</div>
                    <div>Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†Ù‚Ø¯ÛŒ</div>
                </div>
            `;
        }

        function loadTransactionsList() {
            const tbody = document.querySelector('#transactionsTable tbody');
            tbody.innerHTML = '';
            
            if (appData.transactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }
            
            appData.transactions.forEach((transaction, index) => {
                const row = document.createElement('tr');
                const typeBadge = transaction.type === 'income' ? 'badge-success' : 'badge-danger';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaction.date}</td>
                    <td><span class="badge ${typeBadge}">${transaction.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}</span></td>
                    <td>${transaction.category}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td>${transaction.paymentMethod}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewTransaction('${transaction.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTransaction('${transaction.id}')">ğŸ—‘ï¸</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showIncomeModal() {
            showModal('incomeModal');
            document.getElementById('modalIncomeDate').value = new Date().toLocaleDateString('fa-IR');
            document.getElementById('modalIncomeCategory').value = 'ÙØ±ÙˆØ´';
            document.getElementById('modalIncomeAmount').value = '';
            document.getElementById('modalIncomePaymentMethod').value = 'Ù†Ù‚Ø¯ÛŒ';
            document.getElementById('modalIncomeDescription').value = '';
        }

        function saveIncomeModal() {
            const date = document.getElementById('modalIncomeDate').value;
            const category = document.getElementById('modalIncomeCategory').value;
            const amount = parseFloat(document.getElementById('modalIncomeAmount').value) || 0;
            const paymentMethod = document.getElementById('modalIncomePaymentMethod').value;
            const description = document.getElementById('modalIncomeDescription').value.trim();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!date) {
                showValidationError(document.getElementById('modalIncomeDate'), 'ØªØ§Ø±ÛŒØ® Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (amount <= 0) {
                showValidationError(document.getElementById('modalIncomeAmount'), 'Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯');
                return;
            }
            
            if (!description) {
                showValidationError(document.getElementById('modalIncomeDescription'), 'Ø´Ø±Ø­ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                date,
                type: 'income',
                category,
                amount,
                paymentMethod,
                description,
                reference: 'Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø³ØªÙ‚ÛŒÙ…',
                createdBy: appData.currentUser?.name || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…',
                createdAt: new Date().toISOString()
            };
            
            appData.transactions.push(transaction);
            saveData();
            loadTransactionsList();
            updateFinancialSummary();
            closeModal('incomeModal');
            showNotification('Ø¯Ø±Ø¢Ù…Ø¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
        }

        function showExpenseModal() {
            showModal('expenseModal');
            document.getElementById('modalExpenseDate').value = new Date().toLocaleDateString('fa-IR');
            document.getElementById('modalExpenseCategory').value = 'Ø­Ù‚ÙˆÙ‚';
            document.getElementById('modalExpenseAmount').value = '';
            document.getElementById('modalExpensePaymentMethod').value = 'Ù†Ù‚Ø¯ÛŒ';
            document.getElementById('modalExpenseDescription').value = '';
        }

        function saveExpenseModal() {
            const date = document.getElementById('modalExpenseDate').value;
            const category = document.getElementById('modalExpenseCategory').value;
            const amount = parseFloat(document.getElementById('modalExpenseAmount').value) || 0;
            const paymentMethod = document.getElementById('modalExpensePaymentMethod').value;
            const description = document.getElementById('modalExpenseDescription').value.trim();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!date) {
                showValidationError(document.getElementById('modalExpenseDate'), 'ØªØ§Ø±ÛŒØ® Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (amount <= 0) {
                showValidationError(document.getElementById('modalExpenseAmount'), 'Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯');
                return;
            }
            
            if (!description) {
                showValidationError(document.getElementById('modalExpenseDescription'), 'Ø´Ø±Ø­ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                date,
                type: 'expense',
                category,
                amount,
                paymentMethod,
                description,
                reference: 'Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…',
                createdBy: appData.currentUser?.name || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…',
                createdAt: new Date().toISOString()
            };
            
            appData.transactions.push(transaction);
            saveData();
            loadTransactionsList();
            updateFinancialSummary();
            closeModal('expenseModal');
            showNotification('Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
        }

        function viewTransaction(id) {
            const transaction = appData.transactions.find(t => t.id === id);
            if (transaction) {
                alert(`ØªØ±Ø§Ú©Ù†Ø´\nØªØ§Ø±ÛŒØ®: ${transaction.date}\nÙ†ÙˆØ¹: ${transaction.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}\nØ¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${transaction.category}\nØ´Ø±Ø­: ${transaction.description}\nÙ…Ø¨Ù„Øº: ${transaction.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†\nØ±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: ${transaction.paymentMethod}`);
            }
        }

        function deleteTransaction(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.transactions = appData.transactions.filter(t => t.id !== id);
                saveData();
                loadTransactionsList();
                updateFinancialSummary();
                showNotification('ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        // ===== WORKERS PAGE =====
        function loadWorkersPage() {
            loadWorkersList();
            updateWorkerStats();
            loadWorkerSelectOptions();
        }

        function loadWorkersList() {
            const tbody = document.querySelector('#workersTable tbody');
            tbody.innerHTML = '';
            
            if (appData.workers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center py-4">Ù‡ÛŒÚ† Ú©Ø§Ø±Ù…Ù†Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }
            
            appData.workers.forEach((worker, index) => {
                const statusBadge = worker.status === 'ÙØ¹Ø§Ù„' ? 'badge-success' : 
                                  worker.status === 'ØºÛŒØ±ÙØ¹Ø§Ù„' ? 'badge-danger' : 'badge-warning';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${worker.name}</td>
                    <td>${worker.nationalCode}</td>
                    <td>${worker.position}</td>
                    <td>${worker.baseSalary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td>${worker.hasInsurance ? 'âœ…' : 'âŒ'}</td>
                    <td>${worker.startDate}</td>
                    <td><span class="badge ${statusBadge}">${worker.status}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewWorker('${worker.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-warning btn-sm" onclick="editWorker('${worker.id}')">âœï¸</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteWorker('${worker.id}')">ğŸ—‘ï¸</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateWorkerStats() {
            const activeWorkers = appData.workers.filter(w => w.status === 'ÙØ¹Ø§Ù„').length;
            const totalSalary = appData.workers
                .filter(w => w.status === 'ÙØ¹Ø§Ù„')
                .reduce((sum, w) => sum + w.baseSalary, 0);
            
            const statsContainer = document.getElementById('workerStats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${appData.workers.length}</div>
                    <div>Ú©Ù„ Ú©Ø§Ø±Ú©Ù†Ø§Ù†</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <div class="stat-value">${activeWorkers}</div>
                    <div>Ú©Ø§Ø±Ú©Ù†Ø§Ù† ÙØ¹Ø§Ù„</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div class="stat-value">${totalSalary.toLocaleString('fa-IR')}</div>
                    <div>Ú©Ù„ Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡</div>
                </div>
            `;
        }

        function showWorkerModal() {
            showModal('workerModal');
            document.getElementById('modalWorkerName').value = '';
            document.getElementById('modalWorkerNationalCode').value = '';
            document.getElementById('modalWorkerPhone').value = '';
            document.getElementById('modalWorkerPosition').value = 'Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡';
            document.getElementById('modalWorkerBaseSalary').value = '';
            document.getElementById('modalWorkerWeeklyHours').value = '44';
            document.getElementById('modalWorkerStartDate').value = new Date().toLocaleDateString('fa-IR');
            document.getElementById('modalWorkerStatus').value = 'ÙØ¹Ø§Ù„';
            document.getElementById('modalWorkerAddress').value = '';
            document.getElementById('modalWorkerNotes').value = '';
        }

        function saveWorkerModal() {
            const name = document.getElementById('modalWorkerName').value.trim();
            const nationalCode = document.getElementById('modalWorkerNationalCode').value.trim();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!name) {
                showValidationError(document.getElementById('modalWorkerName'), 'Ù†Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!nationalCode) {
                showValidationError(document.getElementById('modalWorkerNationalCode'), 'Ú©Ø¯ Ù…Ù„ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!validateNationalCode(nationalCode)) {
                showValidationError(document.getElementById('modalWorkerNationalCode'), 'Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                return;
            }
            
            const worker = {
                id: Date.now(),
                name,
                nationalCode,
                phone: document.getElementById('modalWorkerPhone').value,
                position: document.getElementById('modalWorkerPosition').value,
                baseSalary: parseFloat(document.getElementById('modalWorkerBaseSalary').value) || 0,
                weeklyHours: parseInt(document.getElementById('modalWorkerWeeklyHours').value) || 44,
                startDate: document.getElementById('modalWorkerStartDate').value || new Date().toLocaleDateString('fa-IR'),
                status: document.getElementById('modalWorkerStatus').value,
                address: document.getElementById('modalWorkerAddress').value,
                notes: document.getElementById('modalWorkerNotes').value,
                hasInsurance: true,
                createdDate: new Date().toLocaleDateString('fa-IR')
            };
            
            appData.workers.push(worker);
            saveData();
            loadWorkersList();
            updateWorkerStats();
            loadWorkerSelectOptions();
            closeModal('workerModal');
            showNotification('Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯', 'success');
        }

        function viewWorker(id) {
            const worker = appData.workers.find(w => w.id === id);
            if (worker) {
                alert(`Ú©Ø§Ø±Ù…Ù†Ø¯: ${worker.name}\nÚ©Ø¯ Ù…Ù„ÛŒ: ${worker.nationalCode}\nØ³Ù…Øª: ${worker.position}\nØ­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡: ${worker.baseSalary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†\nØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯: ${worker.startDate}\nÙˆØ¶Ø¹ÛŒØª: ${worker.status}\nØ¢Ø¯Ø±Ø³: ${worker.address || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${worker.notes || 'Ù†Ø¯Ø§Ø±Ø¯'}`);
            }
        }

        function editWorker(id) {
            const worker = appData.workers.find(w => w.id === id);
            if (worker) {
                const newName = prompt('Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯:', worker.name);
                const newPosition = prompt('Ø³Ù…Øª Ø¬Ø¯ÛŒØ¯:', worker.position);
                
                if (newName && newPosition) {
                    worker.name = newName;
                    worker.position = newPosition;
                    saveData();
                    loadWorkersList();
                    updateWorkerStats();
                    showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
                }
            }
        }

        function deleteWorker(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ù…Ù†Ø¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.workers = appData.workers.filter(w => w.id !== id);
                saveData();
                loadWorkersList();
                updateWorkerStats();
                loadWorkerSelectOptions();
                showNotification('Ú©Ø§Ø±Ù…Ù†Ø¯ Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        function loadWorkerSelectOptions() {
            const select = document.getElementById('salaryWorker');
            select.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>';
            
            appData.workers
                .filter(w => w.status === 'ÙØ¹Ø§Ù„')
                .forEach(worker => {
                    const option = document.createElement('option');
                    option.value = worker.id;
                    option.textContent = `${worker.name} - ${worker.position}`;
                    select.appendChild(option);
                });
        }

        function calculateSalary() {
            const workerId = document.getElementById('salaryWorker').value;
            const monthYear = document.getElementById('salaryMonth').value;
            const overtimeHours = parseFloat(document.getElementById('overtimeHours').value) || 0;
            const deficitHours = parseFloat(document.getElementById('deficitHours').value) || 0;
            const bonus = parseFloat(document.getElementById('bonusAmount').value) || 0;
            const deduction = parseFloat(document.getElementById('deductionAmount').value) || 0;
            const description = document.getElementById('salaryDescription').value;
            
            if (!workerId || !monthYear) {
                showNotification('Ù„Ø·ÙØ§ Ú©Ø§Ø±Ù…Ù†Ø¯ Ùˆ Ù…Ø§Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const worker = appData.workers.find(w => w.id === workerId);
            if (!worker) {
                showNotification('Ú©Ø§Ø±Ù…Ù†Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                return;
            }
            
            const hourlyRate = worker.baseSalary / (worker.weeklyHours * 4);
            const overtimePay = overtimeHours * hourlyRate * (appData.settings.overtimeRate / 100);
            const deficitDeduction = deficitHours * hourlyRate;
            
            const grossSalary = worker.baseSalary + overtimePay - deficitDeduction + bonus - deduction;
            const insurance = grossSalary * 0.07;
            const tax = Math.max(0, (grossSalary - appData.settings.minSalary) * 0.1);
            const netSalary = grossSalary - insurance - tax;
            
            const resultDiv = document.getElementById('salaryResult');
            resultDiv.innerHTML = `
                <h5>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ù‚ÙˆÙ‚ ${worker.name} - ${monthYear}</h5>
                <div class="total-row"><span>Ø­Ù‚ÙˆÙ‚ Ù¾Ø§ÛŒÙ‡:</span><span>${worker.baseSalary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ø§Ø¶Ø§ÙÙ‡ Ú©Ø§Ø±ÛŒ (${overtimeHours} Ø³Ø§Ø¹Øª):</span><span>${overtimePay.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ú©Ø³Ø±ÛŒ Ú©Ø§Ø± (${deficitHours} Ø³Ø§Ø¹Øª):</span><span>-${deficitDeduction.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ù¾Ø§Ø¯Ø§Ø´:</span><span>${bonus.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ú©Ø³ÙˆØ±Ø§Øª:</span><span>-${deduction.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ø¨ÛŒÙ…Ù‡ (7%):</span><span>-${insurance.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <div class="total-row"><span>Ù…Ø§Ù„ÛŒØ§Øª:</span><span>-${tax.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span></div>
                <hr style="border-color: white; margin: 12px 0;">
                <div class="total-row"><span><strong>Ø®Ø§Ù„Øµ Ø­Ù‚ÙˆÙ‚:</strong></span><strong>${netSalary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</strong></div>
                <button class="btn btn-success w-100 mt-3" onclick="saveSalaryRecord('${workerId}', '${monthYear}', ${netSalary}, '${description}')">ğŸ’¾ Ø«Ø¨Øª Ø­Ù‚ÙˆÙ‚</button>
            `;
            resultDiv.style.display = 'block';
        }

        function saveSalaryRecord(workerId, monthYear, netSalary, description) {
            const record = {
                id: Date.now(),
                workerId,
                monthYear,
                netSalary,
                description,
                createdDate: new Date().toLocaleDateString('fa-IR')
            };
            
            appData.salaryRecords.push(record);
            saveData();
            showNotification('Ø­Ù‚ÙˆÙ‚ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
            
            // Add to transactions as expense
            const worker = appData.workers.find(w => w.id === workerId);
            appData.transactions.push({
                id: Date.now(),
                date: new Date().toLocaleDateString('fa-IR'),
                type: 'expense',
                category: 'Ø­Ù‚ÙˆÙ‚',
                amount: netSalary,
                paymentMethod: 'Ú©Ø§Ø±Øª',
                description: `Ø­Ù‚ÙˆÙ‚ ${worker.name} - ${monthYear} - ${description}`,
                reference: 'Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯'
            });
            
            saveData();
            loadFinancePage();
        }

        // ===== INVOICE PAGE =====
        function loadInvoicePage() {
            loadInvoicesList();
            loadCustomerDatalist();
            resetInvoiceForm();
        }

        function resetInvoiceForm() {
            document.getElementById('invoiceCustomer').value = '';
            document.getElementById('invoiceDate').value = new Date().toLocaleDateString('fa-IR');
            document.getElementById('invoiceType').value = 'ÙØ±ÙˆØ´';
            document.getElementById('invoiceDiscount').value = '0';
            document.getElementById('invoiceTax').value = appData.settings.taxRate;
            document.getElementById('invoiceShipping').value = '0';
            
            invoiceItemCount = 0;
            document.getElementById('invoiceItemsContainer').innerHTML = '';
            addInvoiceItem();
            calculateInvoiceTotals();
            
            // Generate invoice number
            const year = new Date().toLocaleDateString('fa-IR').split('/')[0];
            const seq = (appData.invoices.length + 1).toString().padStart(5, '0');
            document.getElementById('invoiceNumber').value = `INV-${year}-${seq}`;
        }

        function addInvoiceItem() {
            invoiceItemCount++;
            const container = document.getElementById('invoiceItemsContainer');
            const row = document.createElement('div');
            row.className = 'invoice-row';
            row.setAttribute('data-invoice-item', invoiceItemCount);
            
            row.innerHTML = `
                <input type="text" class="form-control invoice-description" placeholder="Ø´Ø±Ø­ Ú©Ø§Ù„Ø§/Ø®Ø¯Ù…Øª">
                <input type="number" class="form-control invoice-quantity" placeholder="ØªØ¹Ø¯Ø§Ø¯" min="1" value="1" oninput="calculateInvoiceTotals()">
                <input type="number" class="form-control invoice-price" placeholder="Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯" min="0" oninput="calculateInvoiceTotals()">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeInvoiceItem(${invoiceItemCount})">âœ•</button>
            `;
            
            container.appendChild(row);
        }

        function removeInvoiceItem(itemNumber) {
            document.querySelector(`[data-invoice-item="${itemNumber}"]`).remove();
            calculateInvoiceTotals();
        }

        function calculateInvoiceTotals() {
            let subtotal = 0;
            
            document.querySelectorAll('.invoice-row').forEach(row => {
                const qty = parseFloat(row.querySelector('.invoice-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.invoice-price').value) || 0;
                subtotal += qty * price;
            });
            
            const discount = parseFloat(document.getElementById('invoiceDiscount').value) || 0;
            const taxRate = parseFloat(document.getElementById('invoiceTax').value) || 0;
            const shipping = parseFloat(document.getElementById('invoiceShipping').value) || 0;
            
            const tax = (subtotal - discount) * (taxRate / 100);
            const total = subtotal - discount + tax + shipping;
            
            document.getElementById('invoiceSubtotalDisplay').textContent = `${subtotal.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('invoiceDiscountDisplay').textContent = `${discount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('invoiceTaxDisplay').textContent = `${tax.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('invoiceShippingDisplay').textContent = `${shipping.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
            document.getElementById('invoiceTotalDisplay').textContent = `${total.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
        }

        function saveInvoice() {
            const customer = document.getElementById('invoiceCustomer').value.trim();
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            const invoiceType = document.getElementById('invoiceType').value;
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!customer) {
                showValidationError(document.getElementById('invoiceCustomer'), 'Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
                return;
            }
            
            if (!invoiceNumber) {
                showNotification('Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');
                return;
            }
            
            const items = [];
            document.querySelectorAll('.invoice-row').forEach(row => {
                const description = row.querySelector('.invoice-description').value;
                const quantity = parseFloat(row.querySelector('.invoice-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.invoice-price').value) || 0;
                
                if (description && quantity > 0 && price > 0) {
                    items.push({ description, quantity, price, total: quantity * price });
                }
            });
            
            if (items.length === 0) {
                showNotification('Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯', 'error');
                return;
            }
            
            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const discount = parseFloat(document.getElementById('invoiceDiscount').value) || 0;
            const taxRate = parseFloat(document.getElementById('invoiceTax').value) || 0;
            const shipping = parseFloat(document.getElementById('invoiceShipping').value) || 0;
            const tax = (subtotal - discount) * (taxRate / 100);
            const total = subtotal - discount + tax + shipping;
            
            const invoice = {
                id: Date.now(),
                invoiceNumber,
                customer,
                date: invoiceDate || new Date().toLocaleDateString('fa-IR'),
                type: invoiceType,
                items,
                subtotal,
                discount,
                tax,
                taxRate,
                shipping,
                total,
                status: 'Ø«Ø¨Øª Ø´Ø¯Ù‡',
                createdBy: appData.currentUser?.name || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…'
            };
            
            appData.invoices.push(invoice);
            saveData();
            showNotification('ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
            resetInvoiceForm();
            loadInvoicesList();
            updateDashboard();
        }

        function loadInvoicesList() {
            const tbody = document.querySelector('#invoicesTable tbody');
            tbody.innerHTML = '';
            
            if (appData.invoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }
            
            appData.invoices.forEach((invoice, index) => {
                const statusBadge = invoice.status === 'Ø«Ø¨Øª Ø´Ø¯Ù‡' ? 'badge-success' : 
                                  invoice.status === 'Ù„ØºÙˆ Ø´Ø¯Ù‡' ? 'badge-danger' : 'badge-warning';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${invoice.invoiceNumber}</td>
                    <td>${invoice.customer}</td>
                    <td>${invoice.date}</td>
                    <td>${invoice.type}</td>
                    <td>${invoice.total.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                    <td><span class="badge ${statusBadge}">${invoice.status}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewInvoice('${invoice.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-primary btn-sm" onclick="printInvoice('${invoice.id}')">ğŸ–¨ï¸</button>
                        <button class="btn btn-danger btn-sm" onclick="cancelInvoice('${invoice.id}')">Ù„ØºÙˆ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function viewInvoice(id) {
            const invoice = appData.invoices.find(i => i.id === id);
            if (invoice) {
                const itemsText = invoice.items.map((item, i) => 
                    `${i + 1}. ${item.description} - ${item.quantity} Ø¹Ø¯Ø¯ - ${item.price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† - Ø¬Ù…Ø¹: ${item.total.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`
                ).join('\n');
                
                alert(`ÙØ§Ú©ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡: ${invoice.invoiceNumber}\nÙ…Ø´ØªØ±ÛŒ: ${invoice.customer}\nØªØ§Ø±ÛŒØ®: ${invoice.date}\nÙ†ÙˆØ¹: ${invoice.type}\n\nØ§Ù‚Ù„Ø§Ù…:\n${itemsText}\n\nØ¬Ù…Ø¹ Ú©Ù„: ${invoice.total.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`);
            }
        }

        function printInvoice(id) {
            const invoice = appData.invoices.find(i => i.id === id);
            if (invoice) {
                showNotification(`Ø¯Ø± Ø­Ø§Ù„ Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ± ${invoice.invoiceNumber}...`, 'info');
                setTimeout(() => {
                    showNotification('ÙØ§Ú©ØªÙˆØ± Ú†Ø§Ù¾ Ø´Ø¯', 'success');
                }, 2000);
            }
        }

        function downloadInvoicePDF(id) {
            showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ PDF...', 'info');
            setTimeout(() => {
                showNotification('PDF Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª', 'success');
            }, 2000);
        }

        function cancelInvoice(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                const invoice = appData.invoices.find(i => i.id === id);
                if (invoice) {
                    invoice.status = 'Ù„ØºÙˆ Ø´Ø¯Ù‡';
                    saveData();
                    loadInvoicesList();
                    showNotification('ÙØ§Ú©ØªÙˆØ± Ù„ØºÙˆ Ø´Ø¯', 'success');
                }
            }
        }

        // ===== SETTINGS PAGE =====
        function loadSettingsPage() {
            // Load current settings
            document.getElementById('companyName').value = appData.settings.companyName;
            document.getElementById('companyPhone').value = appData.settings.companyPhone;
            document.getElementById('companyAddress').value = appData.settings.companyAddress;
            document.getElementById('adminUsername').value = appData.auth.username;
            document.getElementById('taxRate').value = appData.settings.taxRate;
            document.getElementById('minSalary').value = appData.settings.minSalary;
            document.getElementById('overtimeRate').value = appData.settings.overtimeRate;
            document.getElementById('primaryColor').value = appData.settings.primaryColor;
            document.getElementById('secondaryColor').value = appData.settings.secondaryColor;
            document.getElementById('themeMode').value = appData.settings.themeMode;
            document.getElementById('autoBackupInterval').value = appData.settings.autoBackupInterval;
        }

        function saveCompanySettings() {
            appData.settings.companyName = document.getElementById('companyName').value;
            appData.settings.companyPhone = document.getElementById('companyPhone').value;
            appData.settings.companyAddress = document.getElementById('companyAddress').value;
            
            saveData();
            showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ø±Ú©Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword) {
                showNotification('Ù„Ø·ÙØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯', 'error');
                return;
            }
            
            appData.auth.password = CryptoJS.SHA256(newPassword).toString();
            saveData();
            
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            showNotification('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯', 'success');
        }

        function saveFinancialSettings() {
            appData.settings.taxRate = parseFloat(document.getElementById('taxRate').value) || 9;
            appData.settings.minSalary = parseFloat(document.getElementById('minSalary').value) || 45000000;
            appData.settings.overtimeRate = parseFloat(document.getElementById('overtimeRate').value) || 40;
            
            saveData();
            showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù„ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        }

        function applyThemeSettings() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const themeMode = document.getElementById('themeMode').value;
            
            appData.settings.primaryColor = primaryColor;
            appData.settings.secondaryColor = secondaryColor;
            appData.settings.themeMode = themeMode;
            
            // Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡
            applyThemeColors();
            
            // Ø§Ø¹Ù…Ø§Ù„ ØªÙ… ØªÛŒØ±Ù‡/Ø±ÙˆØ´Ù†
            if (themeMode === 'dark') {
                document.body.style.background = 'linear-gradient(135deg, #2d3748 0%, #4a5568 50%, #718096 100%)';
                document.body.style.color = '#f7fafc';
                
                // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªÙ… ØªÛŒØ±Ù‡
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.style.background = '#2d3748';
                    card.style.color = '#f7fafc';
                });
                
                // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§
                const tables = document.querySelectorAll('.table');
                tables.forEach(table => {
                    table.style.color = '#f7fafc';
                });
            } else {
                document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)';
                document.body.style.color = '#0f172a';
                
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø±Ù†Ú¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.style.background = 'white';
                    card.style.color = '#0f172a';
                });
                
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø±Ù†Ú¯ Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§
                const tables = document.querySelectorAll('.table');
                tables.forEach(table => {
                    table.style.color = '#0f172a';
                });
            }
            
            showNotification('ØªÙ… Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯', 'success');
        }

        function applyThemeColors() {
            const primary = appData.settings.primaryColor;
            const secondary = appData.settings.secondaryColor;
            
            // Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
            document.documentElement.style.setProperty('--primary', primary);
            document.documentElement.style.setProperty('--secondary', secondary);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†
            const gradients = document.querySelectorAll('.stat-card');
            gradients.forEach(card => {
                if (card.style.background.includes('var(--secondary)')) {
                    card.style.background = `linear-gradient(135deg, ${secondary}, #1d4ed8)`;
                }
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            const primaryButtons = document.querySelectorAll('.btn-primary');
            primaryButtons.forEach(btn => {
                btn.style.background = secondary;
                btn.style.borderColor = secondary;
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ø±
            const cardHeaders = document.querySelectorAll('.card-header');
            cardHeaders.forEach(header => {
                if (header.style.background.includes('var(--primary)')) {
                    header.style.background = `linear-gradient(135deg, ${primary}, #1e40af)`;
                }
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ
            const navButtons = document.querySelectorAll('.nav-btn.active');
            navButtons.forEach(btn => {
                btn.style.background = secondary;
            });
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¯Ø± CSS Ø³ÙØ§Ø±Ø´ÛŒ
            const customStyles = document.createElement('style');
            customStyles.textContent = `
                .custom-primary { color: ${primary} !important; }
                .custom-secondary { color: ${secondary} !important; }
                .bg-custom-primary { background-color: ${primary} !important; }
                .bg-custom-secondary { background-color: ${secondary} !important; }
                .border-custom-primary { border-color: ${primary} !important; }
                .border-custom-secondary { border-color: ${secondary} !important; }
            `;
            document.head.appendChild(customStyles);
            
            saveData();
        }

        // ===== REPORTS PAGE =====
        function loadReportsPage() {
            // Reports page is ready
        }

        function generateReport(type) {
            window.lastReportType = type;
            let reportContent = '';
            
            switch(type) {
                case 'detailed_financial':
                    reportContent = generateDetailedFinancialReport();
                    break;
                case 'customer_analysis':
                    reportContent = generateCustomerAnalysisReport();
                    break;
                case 'check_analysis':
                    reportContent = generateCheckAnalysisReport();
                    break;
                case 'profit_loss':
                    reportContent = generateProfitLossReport();
                    break;
                case 'daily':
                    reportContent = generateDailyReport();
                    break;
                case 'monthly':
                    reportContent = generateMonthlyReport();
                    break;
                case 'profit':
                    reportContent = generateProfitReport();
                    break;
                case 'sales':
                    reportContent = generateSalesReport();
                    break;
                case 'customer_sales':
                    reportContent = generateCustomerSalesReport();
                    break;
                case 'check_status':
                    reportContent = generateCheckStatusReport();
                    break;
                case 'check_due':
                    reportContent = generateCheckDueReport();
                    break;
                default:
                    reportContent = '<div class="alert alert-info">Ù†ÙˆØ¹ Ú¯Ø²Ø§Ø±Ø´ Ù†Ø§Ù…Ø´Ø®Øµ Ø§Ø³Øª</div>';
            }
            
            document.getElementById('reportResults').innerHTML = reportContent;
        }

        function generateDetailedFinancialReport() {
            const incomeByCategory = {};
            const expenseByCategory = {};
            const monthlyTrend = {};
            
            appData.transactions.forEach(t => {
                if (t.type === 'income') {
                    incomeByCategory[t.category] = (incomeByCategory[t.category] || 0) + t.amount;
                } else {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                }
                
                const month = t.date.split('/')[1];
                if (!monthlyTrend[month]) {
                    monthlyTrend[month] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') {
                    monthlyTrend[month].income += t.amount;
                } else {
                    monthlyTrend[month].expense += t.amount;
                }
            });
            
            const totalIncome = Object.values(incomeByCategory).reduce((a, b) => a + b, 0);
            const totalExpense = Object.values(expenseByCategory).reduce((a, b) => a + b, 0);
            const profit = totalIncome - totalExpense;
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ ØªÙØµÛŒÙ„ÛŒ</h5></div>
                    <div style="padding: 20px;">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Ø¯Ø±Ø¢Ù…Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</h6>
                                <div class="table-container">
                                    <table class="table table-sm">
                                        <thead><tr><th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ø¯Ø±ØµØ¯</th></tr></thead>
                                        <tbody>
                                            ${Object.entries(incomeByCategory).map(([cat, amount]) => `
                                                <tr>
                                                    <td>${cat}</td>
                                                    <td>${amount.toLocaleString('fa-IR')}</td>
                                                    <td>${((amount/totalIncome)*100).toFixed(1)}%</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</h6>
                                <div class="table-container">
                                    <table class="table table-sm">
                                        <thead><tr><th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ø¯Ø±ØµØ¯</th></tr></thead>
                                        <tbody>
                                            ${Object.entries(expenseByCategory).map(([cat, amount]) => `
                                                <tr>
                                                    <td>${cat}</td>
                                                    <td>${amount.toLocaleString('fa-IR')}</td>
                                                    <td>${((amount/totalExpense)*100).toFixed(1)}%</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="stats-grid" style="margin-top: 20px;">
                            <div class="stat-card"><div class="stat-value">${totalIncome.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${totalExpense.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><div class="stat-value">${profit.toLocaleString('fa-IR')}</div><div>Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><div class="stat-value">${((profit/totalIncome)*100).toFixed(1)}%</div><div>Ù†Ø³Ø¨Øª Ø³ÙˆØ¯</div></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCustomerAnalysisReport() {
            const customerStats = {};
            const monthlyCustomers = {};
            
            appData.contracts.forEach(c => {
                if (!customerStats[c.customer]) {
                    customerStats[c.customer] = {
                        totalPurchase: 0,
                        contractCount: 0,
                        lastPurchase: c.date
                    };
                }
                customerStats[c.customer].totalPurchase += c.totalAmount;
                customerStats[c.customer].contractCount++;
                
                const month = c.date.split('/')[1];
                if (!monthlyCustomers[month]) {
                    monthlyCustomers[month] = new Set();
                }
                monthlyCustomers[month].add(c.customer);
            });
            
            const topCustomers = Object.entries(customerStats)
                .sort(([,a], [,b]) => b.totalPurchase - a.totalPurchase)
                .slice(0, 10);
            
            return `
                <div class="card">
                    <div class="card-header"><h5>ØªØ­Ù„ÛŒÙ„ Ù…Ø´ØªØ±ÛŒØ§Ù†</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${Object.keys(customerStats).length}</div><div>Ú©Ù„ Ù…Ø´ØªØ±ÛŒØ§Ù†</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);"><div class="stat-value">${(Object.values(customerStats).reduce((sum, c) => sum + c.totalPurchase, 0) / Object.keys(customerStats).length).toLocaleString('fa-IR')}</div><div>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø®Ø±ÛŒØ¯</div></div>
                        </div>
                        <h6 style="margin-top: 20px;">Û±Û° Ù…Ø´ØªØ±ÛŒ Ø¨Ø±ØªØ±:</h6>
                        <div class="table-container">
                            <table class="table">
                                <thead><tr><th>Ø±ØªØ¨Ù‡</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ú©Ù„ Ø®Ø±ÛŒØ¯</th><th>ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</th><th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø®Ø±ÛŒØ¯</th></tr></thead>
                                <tbody>
                                    ${topCustomers.map(([customer, stats], i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td>${customer}</td>
                                            <td>${stats.totalPurchase.toLocaleString('fa-IR')}</td>
                                            <td>${stats.contractCount}</td>
                                            <td>${(stats.totalPurchase / stats.contractCount).toLocaleString('fa-IR')}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCheckAnalysisReport() {
            const today = new Date();
            const statusAnalysis = {
                'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†': { count: 0, amount: 0 },
                'ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡': { count: 0, amount: 0 },
                'Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡': { count: 0, amount: 0 }
            };
            
            const dueAnalysis = {
                'Ø³Ø±Ø±Ø³ÛŒØ¯ Ø´Ø¯Ù‡': [],
                'ØªØ§ Û· Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡': [],
                'ØªØ§ Û³Û° Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡': [],
                'Ø¨ÛŒØ´ Ø§Ø² Û³Û° Ø±ÙˆØ²': []
            };
            
            appData.checks.forEach(check => {
                statusAnalysis[check.status].count++;
                statusAnalysis[check.status].amount += check.amount;
                
                const dueDate = new Date(check.dueDate);
                const diffTime = dueDate.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) {
                    dueAnalysis['Ø³Ø±Ø±Ø³ÛŒØ¯ Ø´Ø¯Ù‡'].push(check);
                } else if (diffDays <= 7) {
                    dueAnalysis['ØªØ§ Û· Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡'].push(check);
                } else if (diffDays <= 30) {
                    dueAnalysis['ØªØ§ Û³Û° Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡'].push(check);
                } else {
                    dueAnalysis['Ø¨ÛŒØ´ Ø§Ø² Û³Û° Ø±ÙˆØ²'].push(check);
                }
            });
            
            return `
                <div class="card">
                    <div class="card-header"><h5>ØªØ­Ù„ÛŒÙ„ Ú†Ú©â€ŒÙ‡Ø§</h5></div>
                    <div style="padding: 20px;">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>ÙˆØ¶Ø¹ÛŒØª Ú†Ú©â€ŒÙ‡Ø§:</h6>
                                <div class="table-container">
                                    <table class="table table-sm">
                                        <thead><tr><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>Ù…Ø¨Ù„Øº</th></tr></thead>
                                        <tbody>
                                            ${Object.entries(statusAnalysis).map(([status, data]) => `
                                                <tr>
                                                    <td>${status}</td>
                                                    <td>${data.count}</td>
                                                    <td>${data.amount.toLocaleString('fa-IR')}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Ø³Ø±Ø±Ø³ÛŒØ¯ Ú†Ú©â€ŒÙ‡Ø§:</h6>
                                <div class="table-container">
                                    <table class="table table-sm">
                                        <thead><tr><th>Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>Ù…Ø¨Ù„Øº</th></tr></thead>
                                        <tbody>
                                            ${Object.entries(dueAnalysis).map(([period, checks]) => `
                                                <tr>
                                                    <td>${period}</td>
                                                    <td>${checks.length}</td>
                                                    <td>${checks.reduce((sum, c) => sum + c.amount, 0).toLocaleString('fa-IR')}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDailyReport() {
            const today = new Date().toLocaleDateString('fa-IR');
            const todayTransactions = appData.transactions.filter(t => t.date === today);
            
            const income = todayTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = todayTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ - ${today}</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${income.toLocaleString('fa-IR')}</div><div>Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ²</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${expense.toLocaleString('fa-IR')}</div><div>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ù…Ø±ÙˆØ²</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><div class="stat-value">${(income - expense).toLocaleString('fa-IR')}</div><div>Ø³ÙˆØ¯ Ø§Ù…Ø±ÙˆØ²</div></div>
                        </div>
                        <div class="table-container" style="margin-top: 20px;">
                            <table class="table">
                                <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ø±Ø­</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹</th></tr></thead>
                                <tbody>
                                    ${todayTransactions.map((t, i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td>${t.description}</td>
                                            <td>${t.amount.toLocaleString('fa-IR')}</td>
                                            <td><span class="badge ${t.type === 'income' ? 'badge-success' : 'badge-danger'}">${t.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateMonthlyReport() {
            const currentMonth = new Date().toLocaleDateString('fa-IR').split('/')[1];
            const currentYear = new Date().toLocaleDateString('fa-IR').split('/')[0];
            
            const monthlyTransactions = appData.transactions.filter(t => {
                const parts = t.date.split('/');
                return parts[0] === currentYear && parts[1] === currentMonth;
            });
            
            const income = monthlyTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = monthlyTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡ - ${currentMonth}/${currentYear}</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${income.toLocaleString('fa-IR')}</div><div>Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${expense.toLocaleString('fa-IR')}</div><div>Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><div class="stat-value">${(income - expense).toLocaleString('fa-IR')}</div><div>Ø³ÙˆØ¯ Ù…Ø§Ù‡</div></div>
                        </div>
                        <div class="table-container" style="margin-top: 20px;">
                            <table class="table">
                                <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ø±Ø­</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹</th></tr></thead>
                                <tbody>
                                    ${monthlyTransactions.map((t, i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td>${t.description}</td>
                                            <td>${t.amount.toLocaleString('fa-IR')}</td>
                                            <td><span class="badge ${t.type === 'income' ? 'badge-success' : 'badge-danger'}">${t.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateProfitReport() {
            const totalIncome = appData.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = appData.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const profit = totalIncome - totalExpense;
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù†</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${totalIncome.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${totalExpense.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><div class="stat-value">${profit.toLocaleString('fa-IR')}</div><div>Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</div></div>
                        </div>
                        <div style="margin-top: 20px;">
                            <h6>Ø®Ù„Ø§ØµÙ‡ Ø¹Ù…Ù„Ú©Ø±Ø¯:</h6>
                            <p>Ù†Ø³Ø¨Øª Ø³ÙˆØ¯ Ø¨Ù‡ Ø¯Ø±Ø¢Ù…Ø¯: ${((profit / totalIncome) * 100).toFixed(1)}%</p>
                            <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯Ø±Ø¢Ù…Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡: ${(totalIncome / 30).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
                            <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø²ÛŒÙ†Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡: ${(totalExpense / 30).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSalesReport() {
            const salesData = appData.contracts.map(c => ({
                customer: c.customer,
                amount: c.totalAmount,
                date: c.date
            }));
            
            const totalSales = salesData.reduce((sum, s) => sum + s.amount, 0);
            const avgSale = salesData.length > 0 ? totalSales / salesData.length : 0;
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${salesData.length}</div><div>ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÙˆØ´</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);"><div class="stat-value">${totalSales.toLocaleString('fa-IR')}</div><div>Ú©Ù„ ÙØ±ÙˆØ´</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><div class="stat-value">${avgSale.toLocaleString('fa-IR')}</div><div>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ÙØ±ÙˆØ´</div></div>
                        </div>
                        <div class="table-container" style="margin-top: 20px;">
                            <table class="table">
                                <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>ØªØ§Ø±ÛŒØ®</th></tr></thead>
                                <tbody>
                                    ${salesData.map((s, i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td>${s.customer}</td>
                                            <td>${s.amount.toLocaleString('fa-IR')}</td>
                                            <td>${s.date}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCustomerSalesReport() {
            const customerSales = {};
            appData.contracts.forEach(c => {
                if (!customerSales[c.customer]) {
                    customerSales[c.customer] = 0;
                }
                customerSales[c.customer] += c.totalAmount;
            });
            
            const sortedCustomers = Object.entries(customerSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø´ØªØ±ÛŒØ§Ù†</h5></div>
                    <div style="padding: 20px;">
                        <div class="table-container">
                            <table class="table">
                                <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ú©Ù„ Ø®Ø±ÛŒØ¯</th></tr></thead>
                                <tbody>
                                    ${sortedCustomers.map(([customer, amount], i) => `
                                        <tr>
                                            <td>${i + 1}</td>
                                            <td>${customer}</td>
                                            <td>${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCheckStatusReport() {
            const statusCounts = {
                pending: appData.checks.filter(c => c.status === 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†').length,
                cleared: appData.checks.filter(c => c.status === 'ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡').length,
                bounced: appData.checks.filter(c => c.status === 'Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡').length
            };
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ú†Ú©â€ŒÙ‡Ø§</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${statusCounts.pending}</div><div>Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);"><div class="stat-value">${statusCounts.cleared}</div><div>ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${statusCounts.bounced}</div><div>Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡</div></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCheckDueReport() {
            const today = new Date();
            const dueChecks = appData.checks.filter(check => {
                if (check.status !== 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†') return false;
                const dueDate = new Date(check.dueDate);
                const diffTime = dueDate.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 7 && diffDays >= 0;
            });
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ø²Ø¯ÛŒÚ© Ø³Ø±Ø±Ø³ÛŒØ¯</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><div class="stat-value">${dueChecks.length}</div><div>Ú†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ø²Ø¯ÛŒÚ© Ø³Ø±Ø±Ø³ÛŒØ¯</div></div>
                        </div>
                        <div class="table-container" style="margin-top: 20px;">
                            <table class="table">
                                <thead><tr><th>Ø±Ø¯ÛŒÙ</th><th>Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù…Ø¨Ù„Øº</th><th>Ø³Ø±Ø±Ø³ÛŒØ¯</th><th>Ù…Ø§Ù†Ø¯Ù‡ Ø±ÙˆØ²</th></tr></thead>
                                <tbody>
                                    ${dueChecks.map((c, i) => {
                                        const dueDate = new Date(c.dueDate);
                                        const diffTime = dueDate.getTime() - today.getTime();
                                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                        return `
                                            <tr>
                                                <td>${i + 1}</td>
                                                <td>${c.number}</td>
                                                <td>${c.customer}</td>
                                                <td>${c.amount.toLocaleString('fa-IR')}</td>
                                                <td>${c.dueDate}</td>
                                                <td><span class="badge badge-danger">${diffDays} Ø±ÙˆØ²</span></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateProfitLossReport() {
            const totalIncome = appData.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = appData.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const profit = totalIncome - totalExpense;
            
            return `
                <div class="card">
                    <div class="card-header"><h5>Ú¯Ø²Ø§Ø±Ø´ Ø³ÙˆØ¯ Ùˆ Ø²ÛŒØ§Ù† Ú©Ø§Ù…Ù„</h5></div>
                    <div style="padding: 20px;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value">${totalIncome.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><div class="stat-value">${totalExpense.toLocaleString('fa-IR')}</div><div>Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡</div></div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"><div class="stat-value">${profit.toLocaleString('fa-IR')}</div><div>Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</div></div>
                        </div>
                        <div style="margin-top: 20px;">
                            <h6>ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯:</h6>
                            <p>Ù†Ø³Ø¨Øª Ø³ÙˆØ¯ Ø¨Ù‡ Ø¯Ø±Ø¢Ù…Ø¯: ${((profit / totalIncome) * 100).toFixed(1)}%</p>
                            <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯Ø±Ø¢Ù…Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡: ${(totalIncome / 30).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
                            <p>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø²ÛŒÙ†Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡: ${(totalExpense / 30).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
                            <p>ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù„ÛŒ: ${profit > 0 ? 'Ø³ÙˆØ¯Ø¯Ù‡ âœ…' : 'Ø²ÛŒØ§Ù† Ø¯Ù‡ âŒ'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function applyDateFilter() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate && !endDate) {
                showNotification('Ù„Ø·ÙØ§Ù‹è‡³å°‘ ÛŒÚ© ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'warning');
                return;
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
            window.reportDateFilter = { startDate, endDate };
            
            showNotification('ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯', 'success');
            
            // Ø¨Ø§Ø²ØªÙˆÙ„ÛŒØ¯ Ø¢Ø®Ø±ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§ ÙÛŒÙ„ØªØ± Ø¬Ø¯ÛŒØ¯
            if (window.lastReportType) {
                generateReport(window.lastReportType);
            }
        }

        // ===== BACKUP PAGE =====
        function loadBackupPage() {
            // Backup page is ready
        }

        function exportToExcel(type = 'contracts') {
            showLoading('Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„...');
            
            try {
                let data, fileName, sheetName;
                
                switch(type) {
                    case 'contracts':
                        data = appData.contracts;
                        fileName = `contracts_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§';
                        break;
                    case 'customers':
                        data = appData.customers;
                        fileName = `customers_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'Ù…Ø´ØªØ±ÛŒØ§Ù†';
                        break;
                    case 'checks':
                        data = appData.checks;
                        fileName = `checks_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'Ú†Ú©â€ŒÙ‡Ø§';
                        break;
                    case 'transactions':
                        data = appData.transactions;
                        fileName = `transactions_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§';
                        break;
                    case 'workers':
                        data = appData.workers;
                        fileName = `workers_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'Ú©Ø§Ø±Ú©Ù†Ø§Ù†';
                        break;
                    case 'invoices':
                        data = appData.invoices;
                        fileName = `invoices_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
                        sheetName = 'ÙØ§Ú©ØªÙˆØ±Ù‡Ø§';
                        break;
                    default:
                        throw new Error('Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±');
                }
                
                if (!data || data.length === 0) {
                    showNotification('Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ØµØ§Ø¯Ø±Ø§Øª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'warning');
                    return;
                }
                
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
                XLSX.writeFile(workbook, fileName);
                
                showNotification(`ÙØ§ÛŒÙ„ ${fileName} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`, 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ØµØ§Ø¯Ø±Ø§Øª Ø§Ú©Ø³Ù„:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„', 'error');
            } finally {
                hideLoading();
            }
        }

        function backupToJSON(encrypt = false) {
            showLoading('Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†...');
            
            try {
                const backupData = {
                    metadata: {
                        version: '13.1',
                        backupDate: new Date().toISOString(),
                        shamsiDate: new Date().toLocaleDateString('fa-IR'),
                        dataVersion: appData.version || '1.0',
                        recordCounts: {
                            contracts: appData.contracts.length,
                            customers: appData.customers.length,
                            transactions: appData.transactions.length,
                            checks: appData.checks.length,
                            workers: appData.workers.length,
                            invoices: appData.invoices.length,
                            salaryRecords: appData.salaryRecords.length
                        }
                    },
                    data: appData
                };
                
                let dataStr, fileName;
                
                if (encrypt) {
                    const password = prompt('Ù„Ø·ÙØ§ ÛŒÚ© Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:', 'kaleshi_' + new Date().toLocaleDateString('fa-IR').split('/')[0]);
                    if (!password) {
                        showNotification('Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ù„ØºÙˆ Ø´Ø¯', 'warning');
                        return;
                    }
                    
                    const encrypted = CryptoJS.AES.encrypt(JSON.stringify(backupData), password).toString();
                    dataStr = encrypted;
                    fileName = `backup_encrypted_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.kaleshi`;
                } else {
                    dataStr = JSON.stringify(backupData, null, 2);
                    fileName = `backup_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.json`;
                }
                
                const blob = new Blob([dataStr], { type: encrypt ? 'application/octet-stream' : 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showNotification(`Ù¾Ø´ØªÛŒØ¨Ø§Ù† ${fileName} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`, 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†', 'error');
            } finally {
                hideLoading();
            }
        }

        function restoreFromBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Ù„Ø·ÙØ§ ÛŒÚ© ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let restoredData;
                    
                    if (file.name.endsWith('.kaleshi')) {
                        const password = prompt('Ù„Ø·ÙØ§ Ø±Ù…Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
                        if (!password) {
                            showNotification('Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù„ØºÙˆ Ø´Ø¯', 'warning');
                            return;
                        }
                        
                        const decrypted = CryptoJS.AES.decrypt(e.target.result, password);
                        restoredData = JSON.parse(decrypted.toString(CryptoJS.enc.Utf8));
                    } else {
                        restoredData = JSON.parse(e.target.result);
                    }
                    
                    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯.')) {
                        appData = restoredData.data || restoredData;
                        saveData();
                        location.reload();
                        showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯', 'success');
                    }
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª - Ø±Ù…Ø² ÛŒØ§ ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function setupAutoBackup() {
            const interval = parseInt(document.getElementById('autoBackupInterval').value);
            appData.settings.autoBackupInterval = interval;
            saveData();
            
            if (interval > 0) {
                const intervalMs = interval * 24 * 60 * 60 * 1000;
                setInterval(() => {
                    if (appData.settings.autoBackupInterval > 0) {
                        backupToJSON(false);
                    }
                }, intervalMs);
                
                showNotification(`Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± ${interval} Ø±ÙˆØ² ÛŒÚ©Ø¨Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯`, 'success');
            } else {
                showNotification('Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯', 'info');
            }
        }

        // ===== DASHBOARD & CHARTS =====
        function updateDashboard() {
            const statsContainer = document.getElementById('stats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${appData.contracts.length}</div>
                    <div>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <div class="stat-value">${appData.customers.length}</div>
                    <div>Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <div class="stat-value">${appData.checks.length}</div>
                    <div>Ú†Ú©â€ŒÙ‡Ø§</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div class="stat-value">${appData.transactions.length}</div>
                    <div>ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                    <div class="stat-value">${appData.workers.length}</div>
                    <div>Ú©Ø§Ø±Ú©Ù†Ø§Ù†</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                    <div class="stat-value">${appData.invoices.length}</div>
                    <div>ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</div>
                </div>
            `;
        }

        function updateCharts() {
            // Income Chart
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            const monthlyIncome = getMonthlyData('income');
            
            if (charts.incomeChart) {
                charts.incomeChart.destroy();
            }
            
            charts.incomeChart = new Chart(incomeCtx, {
                type: 'line',
                data: {
                    labels: monthlyIncome.labels,
                    datasets: [{
                        label: 'Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡',
                        data: monthlyIncome.data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ù†Ù…ÙˆØ¯Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡'
                        }
                    }
                }
            });

            // Expense Chart
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            const monthlyExpense = getMonthlyData('expense');
            
            if (charts.expenseChart) {
                charts.expenseChart.destroy();
            }
            
            charts.expenseChart = new Chart(expenseCtx, {
                type: 'bar',
                data: {
                    labels: monthlyExpense.labels,
                    datasets: [{
                        label: 'Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡',
                        data: monthlyExpense.data,
                        backgroundColor: '#ef4444',
                        borderColor: '#dc2626',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ù†Ù…ÙˆØ¯Ø§Ø± Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡'
                        }
                    }
                }
            });
        }

        function getMonthlyData(transactionType) {
            const monthlyData = {};
            const currentYear = new Date().toLocaleDateString('fa-IR').split('/')[0];
            
            appData.transactions
                .filter(t => t.type === transactionType && t.date.startsWith(currentYear))
                .forEach(t => {
                    const month = t.date.split('/')[1];
                    if (!monthlyData[month]) {
                        monthlyData[month] = 0;
                    }
                    monthlyData[month] += t.amount;
                });
            
            const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
            const labels = months.map(m => `Ù…Ø§Ù‡ ${m}`);
            const data = months.map(m => monthlyData[m] || 0);
            
            return { labels, data };
        }

        // ===== DATA MANAGEMENT =====
        function saveData() {
            try {
                localStorage.setItem('kaleshiFoamData', JSON.stringify(appData));
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
            }
        }

        function loadCustomerDatalist() {
            const datalist = document.getElementById('customerList');
            datalist.innerHTML = '';
            
            appData.customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                datalist.appendChild(option);
            });
        }

        function loadContractsList() {
            const tbody = document.querySelector('#contractsTable tbody');
            tbody.innerHTML = '';
            
            let contracts = appData.contracts;
            const searchTerm = document.getElementById('searchContracts')?.value.toLowerCase();
            
            if (searchTerm) {
                contracts = contracts.filter(c => 
                    c.customer.toLowerCase().includes(searchTerm) ||
                    c.contractNumber.toLowerCase().includes(searchTerm) ||
                    c.phone.includes(searchTerm)
                );
            }
            
            if (contracts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" class="text-center py-4">Ù‡ÛŒÚ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
                return;
            }
            
            contracts.forEach((contract, index) => {
                const statusBadge = contract.status === 'ÙØ¹Ø§Ù„' ? 'badge-success' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${contract.contractNumber}</td>
                    <td>${contract.customer}</td>
                    <td>${contract.phone}</td>
                    <td>${contract.totalAmount.toLocaleString('fa-IR')}</td>
                    <td>${contract.advance.toLocaleString('fa-IR')}</td>
                    <td>${contract.checkAmount.toLocaleString('fa-IR')}</td>
                    <td>${contract.balance.toLocaleString('fa-IR')}</td>
                    <td>${contract.date}</td>
                    <td><span class="badge ${statusBadge}">${contract.status}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewContract('${contract.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-warning btn-sm" onclick="editContract('${contract.id}')">âœï¸</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteContract('${contract.id}')">ğŸ—‘ï¸</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function viewContract(id) {
            const contract = appData.contracts.find(c => c.id === id);
            if (contract) {
                const productsText = contract.products.map((p, i) => 
                    `${i + 1}. ${p.category} - ${p.qty} Ø¹Ø¯Ø¯ - ${p.price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† - Ø¬Ù…Ø¹: ${p.total.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`
                ).join('\n');
                
                const checksText = contract.checks.map((c, i) => 
                    `${i + 1}. Ú†Ú© Ø´Ù…Ø§Ø±Ù‡ ${c.number} - ${c.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† - Ø³Ø±Ø±Ø³ÛŒØ¯: ${c.dueDate}`
                ).join('\n');
                
                alert(`Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø´Ù…Ø§Ø±Ù‡: ${contract.contractNumber}\nÙ…Ø´ØªØ±ÛŒ: ${contract.customer}\nØªÙ„ÙÙ†: ${contract.phone}\nØªØ§Ø±ÛŒØ®: ${contract.date}\n\nÙ…Ø­ØµÙˆÙ„Ø§Øª:\n${productsText}\n\nÚ†Ú©â€ŒÙ‡Ø§:\n${checksText}\n\nØ¬Ù…Ø¹ Ú©Ù„: ${contract.totalAmount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`);
            }
        }

        function editContract(id) {
            const contract = appData.contracts.find(c => c.id === id);
            if (contract) {
                editingId = id;
                
                // Populate form with contract data
                document.getElementById('contractCustomer').value = contract.customer;
                document.getElementById('contractPhone').value = contract.phone;
                document.getElementById('contractAddress').value = contract.address;
                document.getElementById('contractDate').value = contract.date;
                document.getElementById('advancePayment').value = contract.advance;
                
                // Clear and populate products
                document.getElementById('productsContainer').innerHTML = '';
                productRowCount = 0;
                contract.products.forEach(product => {
                    addProductRow();
                    const lastRow = document.querySelector('.product-row:last-child');
                    lastRow.querySelector('.product-category').value = product.category;
                    lastRow.querySelector('.product-qty').value = product.qty;
                    lastRow.querySelector('.product-price').value = product.price;
                });
                
                // Clear and populate checks
                document.getElementById('checksContainer').innerHTML = '';
                checkRowCount = 0;
                contract.checks.forEach(check => {
                    addCheckRow();
                    const lastRow = document.querySelector('.check-row:last-child');
                    lastRow.querySelector('.check-number').value = check.number;
                    lastRow.querySelector('.check-amount').value = check.amount;
                    lastRow.querySelector('.check-due-date').value = check.dueDate;
                });
                
                calculateContractTotals();
                showPage('contracts');
            }
        }

        function deleteContract(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                appData.contracts = appData.contracts.filter(c => c.id !== id);
                saveData();
                loadContractsList();
                updateDashboard();
                showNotification('Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø­Ø°Ù Ø´Ø¯', 'success');
            }
        }

        // ===== INPUT VALIDATION SETUP =====
        function setupInputValidation() {
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡
            document.querySelectorAll('input[type="tel"]').forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value && !validateMobilePhone(this.value)) {
                        showValidationError(this, 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (Ø¨Ø§ÛŒØ¯ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ Ùˆ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯)');
                    } else {
                        clearValidationError(this);
                    }
                });
                
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (this.value.length > 11) {
                        this.value = this.value.slice(0, 11);
                    }
                });
            });
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ
            document.querySelectorAll('input[id*="NationalCode"]').forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value && !validateNationalCode(this.value)) {
                        showValidationError(this, 'Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
                    } else {
                        clearValidationError(this);
                    }
                });
                
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (this.value.length > 10) {
                        this.value = this.value.slice(0, 10);
                    }
                });
            });
        }

        // ===== INITIALIZATION =====
        function initializeSystem() {
            // Initialize flatpickr for all date inputs
            initializePersianCalendar();
            
            // Initialize forms
            resetContractForm();
            resetInvoiceForm();
            
            // Set current date
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('fa-IR');
            
            // Add search functionality
            document.getElementById('searchContracts')?.addEventListener('input', loadContractsList);
            document.getElementById('searchInvoices')?.addEventListener('input', loadInvoicesList);
            
            // Load initial data
            updateDashboard();
            updateCharts();
            loadCustomersList();
            loadChecksList();
            loadTransactionsList();
            loadWorkersList();
            loadInvoicesList();
            
            // Apply saved theme
            applyThemeColors();
            
            // Setup auto backup if enabled
            if (appData.settings.autoBackupInterval > 0) {
                const intervalMs = appData.settings.autoBackupInterval * 24 * 60 * 60 * 1000;
                setInterval(() => {
                    if (appData.settings.autoBackupInterval > 0) {
                        backupToJSON(false);
                    }
                }, intervalMs);
            }
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
            setupInputValidation();
        }

        // ===== EVENT LISTENERS =====
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            if (appData.currentUser) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userName').textContent = appData.currentUser.name;
                initializeSystem();
            }
            
            // Add enter key support for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Apply saved theme
            if (appData.settings.themeMode === 'dark') {
                document.body.style.background = 'linear-gradient(135deg, #2d3748 0%, #4a5568 50%, #718096 100%)';
            }
        });
    </script>
</body>
    </html>
