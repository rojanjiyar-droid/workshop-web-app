<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø´Ø®ØµÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
<style>
:root{
  --primary:#1e3a8a;
  --secondary:#3b82f6;
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#0f172a;
  --danger:#ef4444;
}
body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Vazir,Tahoma;
  background:var(--bg);
  color:var(--text);
}
header{
  background:var(--primary);
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:700;
}
nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:#fff;
  border-top:1px solid #ddd;
}
nav button{
  flex:1;
  border:none;
  background:none;
  padding:8px 0;
  font-size:11px;
}
nav button.active{
  color:var(--secondary);
  font-weight:700;
}
.page{
  display:none;
  padding:15px;
  padding-bottom:90px;
}
.page.active{display:block}
.card{
  background:var(--card);
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 5px 15px rgba(0,0,0,.08);
}
.btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:var(--secondary);
  color:#fff;
  font-weight:600;
  margin-top:10px;
}
.btn-danger{background:var(--danger)}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px;
  font-family:Vazir;
}
.small{font-size:12px;opacity:.7}
.list-item{
  border-bottom:1px solid #eee;
  padding:10px 0;
}
.actions{display:flex;gap:6px;margin-top:6px}
.actions button{flex:1;font-size:12px;padding:8px}
</style>
</head>
<body>

<header>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø´Ø®ØµÛŒ Ú©Ù„Ø´ÛŒâ€ŒÙÙˆÙ…</header>

<!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
<div id="dashboard" class="page active">
  <div class="card">
    <h3>ğŸ“Š Ø®Ù„Ø§ØµÙ‡</h3>
    <div id="summary"></div>
  </div>
</div>

<!-- Ù…Ø´ØªØ±ÛŒØ§Ù† -->
<div id="customers" class="page">
  <div class="card">
    <h3>ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>

    <input placeholder="Ø¬Ø³ØªØ¬Ùˆ..." oninput="renderCustomers(this.value)">

    <div id="customerList"></div>

    <hr>
    <h4>â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h4>
    <input id="cName" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
    <input id="cPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³">
    <button class="btn" onclick="addCustomer()">Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ</button>
  </div>
</div>

<!-- Ù…Ø§Ù„ÛŒ -->
<div id="finance" class="page">
  <div class="card">
    <h3>ğŸ’° Ù…Ø§Ù„ÛŒ</h3>
    <p class="small">Ø¨Ø¹Ø¯Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
  </div>
</div>

<!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
<div id="settings" class="page">
  <div class="card">
    <h3>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h3>
    <button class="btn" onclick="toggleTheme()">ØªØºÛŒÛŒØ± ØªÙ…</button>
  </div>
</div>

<nav>
  <button class="active" onclick="show('dashboard',this)">ğŸ </button>
  <button onclick="show('customers',this)">ğŸ‘¥</button>
  <button onclick="show('finance',this)">ğŸ’°</button>
  <button onclick="show('settings',this)">âš™ï¸</button>
</nav>
<script>
/* ====== DATA ====== */
const DB_VERSION = 1;
let db = {
  version: DB_VERSION,
  customers:[],
  contracts:[],
  checks:[],
  transactions:[],
  workers:[],
  invoices:[],
  settings:{ theme:'light' }
};

/* ====== STORAGE ====== */
function saveDB(){
  localStorage.setItem('kalshiDB', JSON.stringify(db));
}
function loadDB(){
  const d = localStorage.getItem('kalshiDB');
  if(d) db = JSON.parse(d);
  else saveDB();
}
loadDB();
function show(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

function applyTheme(){
  document.body.classList.toggle('dark', db.settings.theme==='dark');
}
function toggleTheme(){
  db.settings.theme = db.settings.theme==='dark'?'light':'dark';
  saveDB(); applyTheme();
}
applyTheme();
function renderSummary(){
  summary.innerHTML = `
    <p>ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†: ${db.customers.length}</p>
    <p>ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§: ${db.contracts.length}</p>
    <p>ğŸ’° ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§: ${db.transactions.length}</p>
  `;
}
renderSummary();

/* ====== CUSTOMERS ====== */
function addCustomer(){
  const name = cName.value.trim();
  const phone = cPhone.value.trim();
  if(!name) return alert('Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');

  db.customers.push({
    id:Date.now(),
    name,phone,
    created:new Date().toISOString()
  });
  cName.value=''; cPhone.value='';
  saveDB();
  renderCustomers();
  renderSummary();
}

function deleteCustomer(id){
  if(!confirm('Ø­Ø°Ù Ù…Ø´ØªØ±ÛŒØŸ')) return;
  db.customers = db.customers.filter(c=>c.id!==id);
  saveDB();
  renderCustomers();
  renderSummary();
}

function editCustomer(id){
  const c = db.customers.find(x=>x.id===id);
  const n = prompt('Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯', c.name);
  if(n!==null){
    c.name=n;
    saveDB();
    renderCustomers();
  }
}

function renderCustomers(q=''){
  customerList.innerHTML='';
  db.customers
    .filter(c=>c.name.includes(q))
    .forEach(c=>{
      customerList.innerHTML+=`
      <div class="list-item">
        <strong>${c.name}</strong><br>
        <span class="small">${c.phone||''}</span>
        <div class="actions">
          <button onclick="editCustomer(${c.id})">âœï¸</button>
          <button class="btn-danger" onclick="deleteCustomer(${c.id})">ğŸ—‘ï¸</button>
        </div>
      </div>`;
    });
}
renderCustomers();
</script>

</body>
</html>
<!-- Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ -->
<div id="contracts" class="page">
  <div class="card">
    <h3>ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§</h3>

    <input placeholder="Ø¬Ø³ØªØ¬Ùˆ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯..." oninput="renderContracts(this.value)">

    <div id="contractList"></div>

    <hr>
    <h4>â• Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯</h4>

    <select id="contractCustomer"></select>
    <input id="contractTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯">
    <input id="contractAmount" type="number" placeholder="Ù…Ø¨Ù„Øº Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (ØªÙˆÙ…Ø§Ù†)">
    <input id="contractAdvance" type="number" placeholder="Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª">
    <input id="contractDate" type="date">

    <button class="btn" onclick="addContract()">Ø«Ø¨Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
  </div>
</div>
<button onclick="show('contracts',this)">ğŸ“</button>
select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px;
  font-family:Vazir;
  background:#fff;
}
body.dark select{background:#1e293b;color:#fff}
/* ====== CONTRACTS ====== */

function loadContractCustomers(){
  contractCustomer.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</option>';
  db.customers.forEach(c=>{
    contractCustomer.innerHTML +=
      `<option value="${c.id}">${c.name}</option>`;
  });
}

function addContract(){
  const customerId = contractCustomer.value;
  const title = contractTitle.value.trim();
  const amount = +contractAmount.value;
  const advance = +contractAdvance.value || 0;
  const date = contractDate.value;

  if(!customerId || !title || !amount){
    alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
    return;
  }

  db.contracts.push({
    id:Date.now(),
    customerId,
    title,
    amount,
    advance,
    date,
    created:new Date().toISOString()
  });

  contractTitle.value='';
  contractAmount.value='';
  contractAdvance.value='';
  contractDate.value='';

  saveDB();
  renderContracts();
  renderSummary();
}

function deleteContract(id){
  if(!confirm('Ø­Ø°Ù Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ØŸ')) return;
  db.contracts = db.contracts.filter(c=>c.id!==id);
  saveDB();
  renderContracts();
  renderSummary();
}

function renderContracts(q=''){
  contractList.innerHTML='';
  db.contracts
    .filter(c=>c.title.includes(q))
    .forEach(c=>{
      const customer = db.customers.find(x=>x.id==c.customerId);
      contractList.innerHTML += `
        <div class="list-item">
          <strong>${c.title}</strong><br>
          <span class="small">
            ğŸ‘¤ ${customer?customer.name:'â€”'} |
            ğŸ’° ${c.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†
          </span>
          <div class="actions">
            <button class="btn-danger"
              onclick="deleteContract(${c.id})">ğŸ—‘ï¸</button>
          </div>
        </div>
      `;
    });
}

/* Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ */
loadContractCustomers();
renderContracts();
loadContractCustomers();
loadContractCustomers();
<nav>
  <button class="active" onclick="show('dashboard',this)">ğŸ </button>
  <button onclick="show('customers',this)">ğŸ‘¥</button>
  <button onclick="show('contracts',this)">ğŸ“</button>
  <button onclick="show('finance',this)">ğŸ’°</button>
  <button onclick="show('settings',this)">âš™ï¸</button>
</nav>
<div id="customers" class="page">
  <div class="card">
    <h3>ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>

    <input placeholder="Ø¬Ø³ØªØ¬Ùˆ..." oninput="renderCustomers(this.value)">

    <div id="customerList"></div>

    <hr>
    <h4>â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h4>
    <input id="cName" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
    <input id="cPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³">
    <button class="btn" onclick="addCustomer()">Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ</button>
  </div>
</div>
function renderSummary(){
  summary.innerHTML = `
    <p>ğŸ‘¥ Ù…Ø´ØªØ±ÛŒØ§Ù†: ${db.customers.length}</p>
    <p>ğŸ“ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§: ${db.contracts.length}</p>
    <p>ğŸ’° ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§: ${db.transactions.length}</p>
  `;
}
<!-- Ù…Ø§Ù„ÛŒ -->
<div id="finance" class="page">
  <div class="card">
    <h3>ğŸ’° Ù…Ø§Ù„ÛŒ</h3>

    <select id="financeType">
      <option value="income">Ø¯Ø±Ø¢Ù…Ø¯</option>
      <option value="expense">Ù‡Ø²ÛŒÙ†Ù‡</option>
    </select>

    <select id="financeContract">
      <option value="">â€” Ø¨Ø¯ÙˆÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ â€”</option>
    </select>

    <input id="financeTitle" placeholder="Ø¹Ù†ÙˆØ§Ù†">
    <input id="financeAmount" type="number" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
    <input id="financeDate" type="date">

    <button class="btn" onclick="addTransaction()">Ø«Ø¨Øª</button>
  </div>

  <div class="card">
    <h4>ğŸ“’ Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h4>
    <div id="financeList"></div>
  </div>
</div>
function loadFinanceContracts(){
  financeContract.innerHTML =
    '<option value="">â€” Ø¨Ø¯ÙˆÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ â€”</option>';
  db.contracts.forEach(c=>{
    financeContract.innerHTML +=
      `<option value="${c.id}">${c.title}</option>`;
  });
}
function addTransaction(){
  const type = financeType.value;
  const contractId = financeContract.value || null;
  const title = financeTitle.value.trim();
  const amount = +financeAmount.value;
  const date = financeDate.value;

  if(!title || !amount){
    alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
    return;
  }

  db.transactions.push({
    id:Date.now(),
    type,
    contractId,
    title,
    amount,
    date,
    created:new Date().toISOString()
  });

  financeTitle.value='';
  financeAmount.value='';
  financeDate.value='';

  saveDB();
  renderFinance();
  renderSummary();
}
function deleteTransaction(id){
  if(!confirm('Ø­Ø°Ù ØªØ±Ø§Ú©Ù†Ø´ØŸ')) return;
  db.transactions = db.transactions.filter(t=>t.id!==id);
  saveDB();
  renderFinance();
  renderSummary();
}

function renderFinance(){
  financeList.innerHTML='';
  db.transactions.forEach(t=>{
    financeList.innerHTML += `
      <div class="list-item">
        <strong>
          ${t.type==='income'?'â•':'â–'}
          ${t.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†
        </strong><br>
        <span class="small">
          ${t.title}
        </span>
        <div class="actions">
          <button class="btn-danger"
            onclick="deleteTransaction(${t.id})">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  });
}
loadFinanceContracts();
loadFinanceContracts();
loadFinanceContracts();
renderFinance();
function contractBalance(contractId){
  let total = 0;
  db.transactions
    .filter(t=>t.contractId==contractId)
    .forEach(t=>{
      total += (t.type==='income'?t.amount:-t.amount);
    });
  return total;
}
<!-- ÙØ§Ú©ØªÙˆØ± -->
<div id="invoices" class="page">
  <div class="card">
    <h3>ğŸ“„ ÙØ§Ú©ØªÙˆØ±</h3>

    <select id="invoiceCustomer"></select>
    <input id="invoiceTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† ÙØ§Ú©ØªÙˆØ±">
    <input id="invoiceAmount" type="number" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
    <input id="invoiceDate" type="date">

    <button class="btn" onclick="addInvoice()">Ø«Ø¨Øª ÙØ§Ú©ØªÙˆØ±</button>
  </div>

  <div class="card">
    <h4>ğŸ“‘ Ù„ÛŒØ³Øª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</h4>
    <div id="invoiceList"></div>
  </div>
</div>
<button onclick="show('invoices',this)">ğŸ“„</button>
function loadInvoiceCustomers(){
  invoiceCustomer.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</option>';
  db.customers.forEach(c=>{
    invoiceCustomer.innerHTML +=
      `<option value="${c.id}">${c.name}</option>`;
  });
}
function addInvoice(){
  const customerId = invoiceCustomer.value;
  const title = invoiceTitle.value.trim();
  const amount = +invoiceAmount.value;
  const date = invoiceDate.value;

  if(!customerId || !title || !amount){
    alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§Ú©ØªÙˆØ± Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
    return;
  }

  db.invoices.push({
    id:Date.now(),
    customerId,
    title,
    amount,
    date,
    created:new Date().toISOString()
  });

  invoiceTitle.value='';
  invoiceAmount.value='';
  invoiceDate.value='';

  saveDB();
  renderInvoices();
}
function deleteInvoice(id){
  if(!confirm('Ø­Ø°Ù ÙØ§Ú©ØªÙˆØ±ØŸ')) return;
  db.invoices = db.invoices.filter(i=>i.id!==id);
  saveDB();
  renderInvoices();
}

function renderInvoices(){
  invoiceList.innerHTML='';
  db.invoices.forEach(i=>{
    const customer = db.customers.find(c=>c.id==i.customerId);
    invoiceList.innerHTML += `
      <div class="list-item">
        <strong>${i.title}</strong><br>
        <span class="small">
          ğŸ‘¤ ${customer?customer.name:'â€”'} |
          ğŸ’° ${i.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†
        </span>
        <div class="actions">
          <button class="btn-danger"
            onclick="deleteInvoice(${i.id})">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  });
}
loadInvoiceCustomers();
loadInvoiceCustomers();
loadInvoiceCustomers();
renderInvoices();
db.transactions.push({
  id:Date.now()+1,
  type:'income',
  contractId:null,
  title:'ÙØ§Ú©ØªÙˆØ±: '+title,
  amount,
  date,
  created:new Date().toISOString()
});
<!-- Ú†Ú©â€ŒÙ‡Ø§ -->
<div id="checks" class="page">
  <div class="card">
    <h3>ğŸ¦ Ú†Ú©â€ŒÙ‡Ø§</h3>

    <select id="checkType">
      <option value="received">Ø¯Ø±ÛŒØ§ÙØªÛŒ</option>
      <option value="paid">Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</option>
    </select>

    <input id="checkNumber" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú†Ú©">
    <input id="checkAmount" type="number" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
    <input id="checkDate" type="date">
    <input id="checkOwner" placeholder="ØµØ§Ø­Ø¨ Ú†Ú© / Ø¨Ø§Ù†Ú©">

    <button class="btn" onclick="addCheck()">Ø«Ø¨Øª Ú†Ú©</button>
  </div>

  <div class="card">
    <h4>ğŸ“‹ Ù„ÛŒØ³Øª Ú†Ú©â€ŒÙ‡Ø§</h4>
    <div id="checkList"></div>
  </div>
</div>
<button onclick="show('checks',this)">ğŸ¦</button>
function addCheck(){
  const type = checkType.value;
  const number = checkNumber.value.trim();
  const amount = +checkAmount.value;
  const date = checkDate.value;
  const owner = checkOwner.value.trim();

  if(!number || !amount || !date){
    alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú†Ú© Ù†Ø§Ù‚Øµ Ø§Ø³Øª');
    return;
  }

  db.checks.push({
    id:Date.now(),
    type,
    number,
    amount,
    date,
    owner,
    status:'pending',
    created:new Date().toISOString()
  });

  checkNumber.value='';
  checkAmount.value='';
  checkDate.value='';
  checkOwner.value='';

  saveDB();
  renderChecks();
}
function deleteCheck(id){
  if(!confirm('Ø­Ø°Ù Ú†Ú©ØŸ')) return;
  db.checks = db.checks.filter(c=>c.id!==id);
  saveDB();
  renderChecks();
}

function renderChecks(){
  checkList.innerHTML='';
  db.checks.forEach(c=>{
    checkList.innerHTML += `
      <div class="list-item">
        <strong>
          ${c.type==='received'?'â•':'â–'}
          ${c.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†
        </strong><br>
        <span class="small">
          ğŸ§¾ ${c.number} |
          ğŸ“… ${c.date} |
          ${c.owner||''}
        </span>
        <div class="actions">
          <button class="btn-danger"
            onclick="deleteCheck(${c.id})">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  });
}
function checkAlerts(){
  const today = new Date().toISOString().slice(0,10);
  const due = db.checks.filter(c=>c.date<=today && c.status==='pending');
  if(due.length){
    alert(`âš ï¸ ${due.length} Ú†Ú© Ø³Ø±Ø±Ø³ÛŒØ¯ Ø´Ø¯Ù‡ ÛŒØ§ Ø§Ù…Ø±ÙˆØ² Ø³Ø±Ø±Ø³ÛŒØ¯ Ø¯Ø§Ø±Ø¯`);
  }
}
checkAlerts();
db.transactions.push({
  id:Date.now()+2,
  type: type==='received'?'income':'expense',
  contractId:null,
  title:'Ú†Ú© '+number,
  amount,
  date,
  created:new Date().toISOString()
});
